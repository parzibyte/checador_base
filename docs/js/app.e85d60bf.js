(function(){"use strict";var a={1264:function(a,t,e){var r=e(6369),i=function(){var a=this,t=a._self._c;return t("div",[t("b-navbar",{attrs:{type:"is-primary"},scopedSlots:a._u([{key:"start",fn:function(){return[t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"VerRutas"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"routes"}}),a._v(" Rutas")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"GestionarUnidades"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"bus-multiple"}}),a._v(" Unidades")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"VerRoles"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"sync"}}),a._v(" Roles")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"Ajustes"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"cog"}}),a._v(" Ajustes")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"ReporteUnidades"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Reporte")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"RegistrarGrupo"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Registrar grupo")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"RegistrarHorario"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Registrar horario")],1),t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"TablaHorarios"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Tabla ")],1)]},proxy:!0},{key:"end",fn:function(){return[t("b-navbar-item",{attrs:{tag:"router-link",to:{name:"AcercaDe"}}},[t("b-icon",{staticClass:"mr-1",attrs:{icon:"code-braces"}}),a._v(" Acerca de")],1)]},proxy:!0}])}),t("section",{staticClass:"section",staticStyle:{padding:"0.1rem"}},[t("router-view")],1)],1)},o=[],n=e(442),s=e.n(n),l=e(6867);const c=()=>{const a={name:"unidades",columns:{id:{primaryKey:!0,autoIncrement:!0,dataType:l.DATA_TYPE.Number},idRuta:{notNull:!0,dataType:l.DATA_TYPE.Number},prioridad:{autoIncrement:!0,dataType:l.DATA_TYPE.Number},numero:{notNull:!0,dataType:l.DATA_TYPE.Number},entrada:{dataType:l.DATA_TYPE.Number,notNull:!0},horaLlamada:{dataType:l.DATA_TYPE.Number,default:0},salida:{dataType:l.DATA_TYPE.Number,default:0},segundosDesdeSalidaAnterior:{notNull:!0,dataType:l.DATA_TYPE.Number,default:0},esEspecial:{notNull:!0,dataType:l.DATA_TYPE.Boolean,default:!1},ruta:{dataType:l.DATA_TYPE.Object,notNull:!0}}},t={name:"rutas",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},color:{notNull:!0,dataType:l.DATA_TYPE.String},mensajeLlamada:{dataType:l.DATA_TYPE.String,notNull:!0},mensajeSalida:{dataType:l.DATA_TYPE.String,notNull:!0}}},e={name:"roles",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},rutas:{notNull:!0,dataType:l.DATA_TYPE.Array}}},r={name:"ajustes",columns:{id:{primaryKey:!0,autoIncrement:!0},rolSeleccionado:{notNull:!0,dataType:l.DATA_TYPE.Object}}},i={name:"grupos",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},unidadesRaw:{notNull:!0,dataType:l.DATA_TYPE.String},unidades:{notNull:!0,dataType:l.DATA_TYPE.Array}}},o={name:"horarios",columns:{id:{primaryKey:!0,autoIncrement:!0},rutas:{notNull:!0,dataType:l.DATA_TYPE.Array},marcaDeTiempo:{notNull:!0,dataType:l.DATA_TYPE.Number}}},n={name:"checador",tables:[a,t,e,r,i,o]};return n},d=new l.Connection;d.addPlugin(s());var u=d;const m=async()=>{const a=c();return await d.initDb(a)};var h={name:"app",async beforeCreate(){const a=await m();console.log({ok:a});const t="https://dapperdownrightlightweightprocess.parzibyte.repl.co/contador/registrar_visita.php",e={pagina:document.title,url:window.location.href};fetch(t,{method:"POST",body:JSON.stringify(e)})}},p=h,b=e(1001),f=(0,b.Z)(p,i,o,!1,null,null,null),g=f.exports,v=e(9515),y=(e(387),e(2631)),_=function(){var a=this,t=a._self._c;return t("div",[t("b-field",{attrs:{label:"Nueva ruta"}},[t("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.nombre,callback:function(t){a.nombre=t},expression:"nombre"}})],1),t("b-field",{attrs:{label:"Color"}},[t("b-colorpicker",{model:{value:a.color,callback:function(t){a.color=t},expression:"color"}})],1),t("b-field",{attrs:{label:"Mensaje de sonido(opcional)"}},[t("b-input",{attrs:{type:"textarea"},model:{value:a.mensajeLlamada,callback:function(t){a.mensajeLlamada=t},expression:"mensajeLlamada"}})],1),t("b-button",{attrs:{type:"is-info"},on:{click:a.guardar}},[a._v("Guardar")]),t("b-button",{staticClass:"ml-2",attrs:{type:"is-primary"},on:{click:a.volver}},[a._v("Volver")])],1)},w=[];const T=async(a,t,e,r)=>{const i=await u.insert({into:"rutas",values:[{nombre:a,color:t,mensajeLlamada:e,mensajeSalida:r}],return:!0});return i[0]},E=async()=>await u.select({from:"rutas"}),A=async a=>await u.remove({from:"rutas",where:{id:a}});var C=e(3352),N={data:()=>({nombre:"",color:C.ZP.parse("#8bc34a"),mensajeSalida:"",mensajeLlamada:""}),methods:{volver(){this.$router.go(-1)},async guardar(){this.nombre&&(await T(this.nombre,this.color.toString(),this.mensajeLlamada,this.mensajeSalida),this.nombre=this.mensajeLlamada=this.mensajeSalida="",this.color=C.ZP.parse("#8bc34a"),this.$buefy.toast.open("Guardada"))}}},R=N,k=(0,b.Z)(R,_,w,!1,null,null,null),S=k.exports,D=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-button",{staticClass:"mb-2",attrs:{type:"is-info"},on:{click:a.registrarNuevaRuta}},[a._v("Registrar nueva")]),t("b-table",{attrs:{data:a.rutas,striped:!0},scopedSlots:a._u([{key:"empty",fn:function(){return[t("div",{staticClass:"has-text-centered"},[a._v("No hay datos")])]},proxy:!0}])},[t("b-table-column",{attrs:{"td-attrs":a.atributosCelda,field:"color",label:"Color"}},[a._v("   ")]),t("b-table-column",{attrs:{field:"nombre",label:"Nombre"},scopedSlots:a._u([{key:"default",fn:function(t){return[a._v(" "+a._s(t.row.nombre)+" ")]}}])}),t("b-table-column",{attrs:{field:"mensajeLlamada",label:"Mensaje de llamada"},scopedSlots:a._u([{key:"default",fn:function(t){return[a._v(" "+a._s(t.row.mensajeLlamada)+" ")]}}])}),t("b-table-column",{attrs:{field:"mensajeSalida",label:"Mensaje de salida"},scopedSlots:a._u([{key:"default",fn:function(t){return[a._v(" "+a._s(t.row.mensajeSalida)+" ")]}}])}),t("b-table-column",{attrs:{field:"id",label:"Eliminar"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("b-button",{attrs:{type:"is-danger"},on:{click:function(t){return a.eliminar(e.row)}}},[t("b-icon",{attrs:{icon:"delete"}})],1)]}}])})],1)],1)])])},x=[],U=(e(7658),{data:()=>({rutas:[]}),async mounted(){await this.obtenerRutas()},methods:{atributosCelda(a){return{style:{backgroundColor:a.color}}},registrarNuevaRuta(){this.$router.push({name:"RegistrarRuta"})},async obtenerRutas(){this.rutas=await E()},async eliminar(a){this.$buefy.dialog.confirm({message:`¿Eliminar ruta ${a.nombre}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await A(a.id),await this.obtenerRutas()}})}}}),O=U,P=(0,b.Z)(O,D,x,!1,null,null,null),I=P.exports,M=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"container"},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-field",{attrs:{label:"Hora"}},[t("b-timepicker",{attrs:{rounded:"",icon:"clock","enable-seconds":!0,"hour-format":"24",locale:"es-MX"},model:{value:a.unidad.hora,callback:function(t){a.$set(a.unidad,"hora",t)},expression:"unidad.hora"}})],1),t("b-field",{attrs:{label:"Ruta"}},[t("b-select",{attrs:{expanded:""},model:{value:a.unidad.ruta,callback:function(t){a.$set(a.unidad,"ruta",t)},expression:"unidad.ruta"}},a._l(a.rutas,(function(e){return t("option",{key:e.id,domProps:{value:e}},[a._v(" "+a._s(e.nombre)+" ")])})),0)],1),t("b-field",{attrs:{label:"Número de unidad"}},[t("b-input",{model:{value:a.unidad.numero,callback:function(t){a.$set(a.unidad,"numero",a._n(t))},expression:"unidad.numero"}})],1),t("teclado-numerico",{on:{teclaPresionada:a.onTeclaPresionada,borrar:a.onTeclaBorrada,borrarTodo:a.onBorrarTodo}}),t("b-button",{attrs:{size:"is-large",type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),t("b-button",{staticClass:"ml-2",attrs:{size:"is-large",type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],1)])])])},L=[],Z=function(){var a=this,t=a._self._c;return t("div",{staticClass:"has-text-centered",staticStyle:{"max-width":"300px"}},[a._l(a.teclado,(function(e){return t("b-button",{key:e,staticClass:"m-2",attrs:{size:"is-large",type:"is-primary"},on:{click:function(t){return a.teclaPresionada(e)}}},[a._v(a._s(e))])})),t("b-button",{staticClass:"m-2",attrs:{size:"is-large",type:"is-warning"},on:{click:a.borrar}},[t("b-icon",{attrs:{icon:"backspace"}})],1),t("b-button",{staticClass:"m-2",attrs:{size:"is-large",type:"is-danger"},on:{click:a.borrarTodo}},[a._v("C")])],2)},j=[],F={data:()=>({teclado:"1234567890".split("")}),methods:{borrarTodo(){this.$emit("borrarTodo")},teclaPresionada(a){this.$emit("teclaPresionada",a)},borrar(){this.$emit("borrar")}}},z=F,V=(0,b.Z)(z,Z,j,!1,null,null,null),$=V.exports;const Y=async(a,t,e)=>{const r=await u.select({from:"unidades",limit:1,where:{numero:a,entrada:{"-":{low:t,high:e}},salida:0}});return r.length>0?r[0]:{}},G=async a=>await u.select({from:"unidades",where:{salida:{"!=":0},numero:a},order:{by:"salida",type:"asc"}}),H=async()=>await u.select({from:"unidades",where:{salida:{"!=":0}},order:{by:"salida",type:"asc"}}),B=async(a,t,e,r)=>{r=r||!1;const i=await u.insert({into:"unidades",values:[{idRuta:e.id,numero:a,entrada:t,ruta:e,esEspecial:r,salida:0,segundosDesdeSalidaAnterior:0,horaLlamada:0}],return:!0});return i[0]},Q=async a=>await u.update({in:"unidades",set:{horaLlamada:(new Date).getTime()},where:{id:a}}),J=async(a,t)=>await u.select({from:"unidades",where:{entrada:{"-":{low:a,high:t}},salida:0},order:{by:"prioridad",type:"asc"}}),X=async(a,t,e)=>await u.select({from:"unidades",where:{entrada:{"-":{low:t,high:e}},salida:{"!=":0},numero:a},order:{by:"salida",type:"desc"}}),W=async(a,t,e,r)=>{const i=await u.select({from:"unidades",limit:1,where:{id:{"!=":a},entrada:{"-":{low:e,high:r}},horaLlamada:{"!=":0},idRuta:t},order:{by:"horaLlamada",type:"desc"}});return i.length>0?i[0]:{}},K=async(a,t)=>await u.count({from:"unidades",where:{entrada:{"-":{low:a,high:t}},esEspecial:!0}}),q=async(a,t)=>await u.count({from:"unidades",where:{entrada:{"-":{low:a,high:t}}}}),aa=async a=>{await u.remove({from:"ajustes"});const t=await u.insert({into:"ajustes",values:[{rolSeleccionado:a}],return:!0});return t[0]},ta=async()=>{const a=await u.select({from:"ajustes"});return Array.isArray(a)&&a.length>0?a[0]:{}},ea=async(a,t)=>{const e=await u.insert({into:"roles",values:[{nombre:a,rutas:t}],return:!0});return e[0]},ra=async()=>await u.select({from:"roles"}),ia=async a=>await u.remove({from:"roles",where:{id:a}}),oa=async()=>{const a=await ta();return a.rolSeleccionado};var na={props:["esHijo"],components:{TecladoNumerico:$},data:()=>({unidad:{hora:new Date,numero:null,ruta:null},rutas:[],rolSeleccionado:{}}),async mounted(){this.rutas=await E(),this.rolSeleccionado=await oa(),this.elegirRutaAutomaticamenteSegunRol(),this.refrescarHora()},methods:{volver(){this.$router.go(-1)},async elegirRutaAutomaticamenteSegunRol(){if(!this.rolSeleccionado)return void this.$buefy.toast.open("No hay ningún rol seleccionado, imposible determinar ruta automáticamente");const a=await q(0,(new Date).getTime()),t=await K(0,(new Date).getTime());let e=(a-t)%this.rolSeleccionado.rutas.length;const r=this.rolSeleccionado.rutas[e];this.unidad.ruta=r},async guardar(){if(!this.unidad.numero)return;if(!this.unidad.ruta)return;if(this.esHijo)return void this.$emit("guardado",this.unidad);const a=await Y(this.unidad.numero,0,(new Date).getTime());if(a.numero)return this.$buefy.toast.open({message:"La unidad ya está dentro de la base",type:"is-danger"}),void this.volver();await B(this.unidad.numero,this.unidad.hora.getTime(),this.unidad.ruta,!1),this.$buefy.toast.open("Guardada"),this.unidad={hora:new Date,numero:null,ruta:null},this.$router.push({name:"GestionarUnidades"})},onBorrarTodo(){this.unidad.numero=null},refrescarHora(){this.unidad.hora=new Date,setTimeout(this.refrescarHora,500)},onTeclaPresionada(a){let t="";this.unidad.numero&&(t=this.unidad.numero.toString()),t+=a,this.unidad.numero=parseInt(t)},onTeclaBorrada(){let a="";this.unidad.numero&&(a=this.unidad.numero.toString()),a=a.split("").slice(0,-1).join(""),this.unidad.numero=a?parseInt(a):null}}},sa=na,la=(0,b.Z)(sa,M,L,!1,null,null,null),ca=la.exports,da=function(){var a=this,t=a._self._c;return t("div",[t("b-modal",{attrs:{active:a.mostrarModalAgregarUnidad,"aria-modal":"","aria-role":"dialog","has-modal-card":"","destroy-on-hide":!0,"trap-focus":""},on:{"update:active":function(t){a.mostrarModalAgregarUnidad=t}}},[t("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[t("section",{staticClass:"modal-card-body"},[t("registrar-unidad",{attrs:{esHijo:!0},on:{guardado:a.onUnidadAgregadaAdelante}})],1),t("footer",{staticClass:"modal-card-foot"},[t("b-button",{on:{click:function(t){return a.cerrarModalAgregarUnidad()}}},[a._v("Cancelar")])],1)])]),t("b-modal",{attrs:{active:a.mostrarModalSeleccionarRuta,"has-modal-card":"","destroy-on-hide":!0,"trap-focus":""},on:{"update:active":function(t){a.mostrarModalSeleccionarRuta=t}}},[t("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[t("section",{staticClass:"modal-card-body"},[t("seleccionador-de-rutas",{on:{seleccionada:a.onRutaSeleccionada}})],1),t("footer",{staticClass:"modal-card-foot"},[t("b-button",{on:{click:function(t){return a.cerrarModalSeleccionarRuta()}}},[a._v("Cancelar")])],1)])]),t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-button",{staticClass:"mb-1",attrs:{size:"is-small",type:"is-info"},on:{click:a.registrarNuevaUnidad}},[a._v("Registrar nueva")]),a._l(a.unidades,(function(e,r){return t("div",{key:e.id,staticStyle:{"margin-bottom":"0.1rem",padding:"0"},style:{backgroundColor:e.ruta.color}},[t("p",[t("span",{staticClass:"is-size-4"},[a._v(a._s(r+1)+"     "+a._s(e.numero)+" "+a._s(e.ruta.nombre)+" ")]),t("b-tag",{directives:[{name:"show",rawName:"v-show",value:e.horaLlamada,expression:"unidad.horaLlamada"}],staticClass:"ml-1",staticStyle:{"font-size":"1rem"},attrs:{icon:"phone",type:a.tipoDeTagParaTiempoTranscurrido(e.horaLlamada)}},[a._v(" "+a._s(a._f("fechaAPartirDeMilisegundos")(a.transcurrido(e.horaLlamada)))+" ")]),t("b-tag",{directives:[{name:"show",rawName:"v-show",value:!e.horaLlamada,expression:"!unidad.horaLlamada"}],staticClass:"ml-2",staticStyle:{"font-size":"1rem"},attrs:{icon:"arrow-up-thin",type:a.colorParaTagDePrediccion(r)}},[a._v(" "+a._s(a._f("fechaAPartirDeMilisegundos")(a.calcularSalida(r)))+" ")]),t("b-dropdown",{scopedSlots:a._u([{key:"trigger",fn:function({active:a}){return[t("b-button",{staticClass:"ml-1",attrs:{size:"is-small",type:"is-warning "}},[t("b-icon",{attrs:{icon:"dots-horizontal"}})],1)]}}],null,!0)},[t("b-dropdown-item",{staticClass:"has-text-centered"},[a._v(" Unidad "),t("strong",[a._v(a._s(e.numero)+" ")]),a._v(" para "),t("strong",[a._v(" "+a._s(e.ruta.nombre))])]),t("b-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:!e.horaLlamada&&0===r,expression:"!unidad.horaLlamada && indice === 0"}],on:{click:function(t){return a.llamar(e)}}},[a._v("Llamar")]),t("b-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:e.horaLlamada,expression:"unidad.horaLlamada"}],on:{click:function(t){return a.darSalida(r)}}},[a._v("Dar salida")]),t("b-dropdown-item",{on:{click:function(t){return a.moverHaciaAdelante(r)}}},[a._v("Mover número hacia adelante")]),t("b-dropdown-item",{on:{click:function(t){return a.moverRutaHaciaAdelante(r)}}},[a._v("Mover ruta hacia adelante")]),t("b-dropdown-item",{on:{click:function(t){return a.eliminarDeLaLista(r)}}},[a._v("Eliminar de la lista")]),t("b-dropdown-item",{on:{click:function(t){return a.moverAlFondo(r)}}},[a._v("Mover al fondo")]),t("b-dropdown-item",{on:{click:function(t){return a.agregarUnidadAdelante(r)}}},[a._v("Tepepan")]),t("b-dropdown-item",{on:{click:function(t){return a.tacopan(r)}}},[a._v("Tacopan")])],1),t("b-button",{directives:[{name:"show",rawName:"v-show",value:0===r,expression:"indice === 0"}],staticClass:"ml-1",attrs:{size:"is-small"},on:{click:function(t){return a.hablar(e.ruta.mensajeLlamada,e)}}},[t("b-icon",{attrs:{icon:"bullhorn"}})],1)],1),t("span",[a._v(" "+a._s(e.ultimaUnidadQueFueALaMismaRuta.numero)+" ("+a._s(a._f("fechaAPartirDeMilisegundos")(e.ultimaUnidadQueFueALaMismaRuta.salida))+") ")]),a._l(e.rutasPrevias,(function(e,r){return t("span",{key:r,staticStyle:{height:"1rem",border:"1px solid black"},style:{backgroundColor:e.ruta.color}},[a._v("       ")])}))],2)}))],2)])],1)},ua=[],ma=function(){var a=this,t=a._self._c;return t("b-field",[t("b-select",{attrs:{expanded:""},model:{value:a.ruta,callback:function(t){a.ruta=t},expression:"ruta"}},a._l(a.rutas,(function(e){return t("option",{key:e.id,domProps:{value:e}},[a._v(" "+a._s(e.nombre)+" ")])})),0),t("p",{staticClass:"control"},[t("b-button",{attrs:{type:"is-primary",label:"Ok"},on:{click:a.guardar}})],1)],1)},ha=[],pa={data:()=>({rutas:[],ruta:{}}),async mounted(){this.rutas=await E()},methods:{guardar(){this.ruta.id&&this.$emit("seleccionada",this.ruta)}}},ba=pa,fa=(0,b.Z)(ba,ma,ha,!1,null,null,null),ga=fa.exports,va={components:{RegistrarUnidad:ca,SeleccionadorDeRutas:ga},data:()=>({cargando:!1,unidades:[],horaActual:new Date,idTimeout:null,mostrarModalAgregarUnidad:!1,mostrarModalSeleccionarRuta:!1,indiceUnidadEditada:{}}),async mounted(){this.refrescarHora(),await this.obtenerUnidades()},beforeDestroy(){clearTimeout(this.idTimeout)},methods:{hablar(a,t){if(!a)return;const e={"{nombreRuta}":t.ruta.nombre,"{numeroUnidad}":t.numero};let r=a;for(const[o,n]of Object.entries(e))r=r.replaceAll(o,n);let i=new SpeechSynthesisUtterance(r);speechSynthesis.speak(i)},colorParaTagDePrediccion(a){const t=this.calcularSalida(a),e=new Date(t),r=new Date,i=r.getFullYear(),o=r.getMonth(),n=r.getDate(),s=[{color:"is-warning",minutos:[15,45]},{color:"is-danger",horarios:[new Date(i,o,n,10,30,0,0),new Date(i,o,n,12,30,0,0),new Date(i,o,n,14,30,0,0),new Date(i,o,n,16,30,0,0),new Date(i,o,n,19,0,0,0)]}];for(const l of s){if(l.minutos)for(const a of l.minutos){const r=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),a,0),i=(r-t)/1e3/60;if(i>=0&&i<=5)return l.color}if(l.horarios)for(const a of l.horarios){const e=(a-t)/1e3/60;if(e>=0&&e<=5)return l.color}}return"is-info"},async onRutaSeleccionada(a){const t=this.indiceUnidadEditada,e=this.unidades[t];await u.update({in:"unidades",set:{ruta:a,esEspecial:!0,idRuta:a.id},where:{id:e.id}});for(let r=t+1;r<this.unidades.length;r++)await u.update({in:"unidades",set:{ruta:this.unidades[r-1].ruta,idRuta:a.id},where:{id:this.unidades[r].id}});await this.obtenerUnidades(),this.cerrarModalSeleccionarRuta()},cerrarModalSeleccionarRuta(){this.mostrarModalSeleccionarRuta=!1},calcularSalida(a){if(this.unidades.length<=0)return 0;const t=this.unidades[0];return t.horaLlamada?t.horaLlamada+1e3*a*60*2.5:0},async tacopan(a){this.indiceUnidadEditada=a,this.mostrarModalSeleccionarRuta=!0},async onUnidadAgregadaAdelante(a){const t=this.unidades[this.indiceUnidadEditada];this.mostrarModalAgregarUnidad=!1;const e=await B(a.numero,a.hora.getTime(),a.ruta,!0);await u.update({in:"unidades",set:{prioridad:t.prioridad},where:{id:e.id}});for(let r=this.indiceUnidadEditada;r<this.unidades.length;r++)await u.update({in:"unidades",set:{prioridad:this.unidades[r].prioridad+1},where:{id:this.unidades[r].id}});await this.obtenerUnidades()},cerrarModalAgregarUnidad(){this.mostrarModalAgregarUnidad=!1},agregarUnidadAdelante(a){this.indiceUnidadEditada=a,this.mostrarModalAgregarUnidad=!0},tipoDeTagParaTiempoTranscurrido(a){const t=new Date,e=t-a,r=9e4;return e>=r?"is-danger":"is-info"},estiloDeStrong(a){const t=new Date,e=t-a,r=9e4;return e>=r?{backgroundColor:"red"}:{}},async llamar(a){await Q(a.id),await this.obtenerUnidades()},async moverAlFondo(a){for(let t=a+1;t<this.unidades.length;t++)await this.moverHaciaAdelante(t)},async eliminarUnidad(a){this.cargando=!0,await u.remove({from:"unidades",where:{id:a}}),this.cargando=!1},async eliminarDeLaLista(a){this.cargando=!0;const t=this.unidades.length;for(let e=a;e<t-1;e++){const a=this.unidades[e+1],t=this.unidades[e];await u.update({in:"unidades",set:{ruta:t.ruta,idRuta:t.ruta.id,esEspecial:t.esEspecial||!1},where:{id:a.id}})}await this.eliminarUnidad(this.unidades[a].id),await this.obtenerUnidades(),this.cargando=!1},async darSalida(a){const t=this.unidades[a];if(this.cargando=!0,await u.update({in:"unidades",set:{salida:(new Date).getTime(),segundosDesdeSalidaAnterior:999},where:{id:t.id}}),this.$buefy.toast.open("Salida marcada correctamente"),a+1<this.unidades.length){const t=this.unidades[a+1];t.horaLlamada||this.llamar(t)}await this.obtenerUnidades(),this.cargando=!1},transcurrido(a){const t=new Date(this.horaActual-new Date(a));return t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),t},refrescarHora(){this.horaActual=new Date,clearTimeout(this.idTimeout),this.idTimeout=setTimeout(this.refrescarHora,500)},async moverRutaHaciaAdelante(a){if(this.cargando=!0,a<=0)return void this.$buefy.toast.open("No se puede mover hacia adelante la primera unidad");const t=this.unidades[a-1],e=this.unidades[a];await u.update({in:"unidades",set:{ruta:t.ruta,idRuta:t.ruta.id},where:{id:e.id}}),await u.update({in:"unidades",set:{ruta:e.ruta,idRuta:e.ruta.id},where:{id:t.id}}),await this.obtenerUnidades(),this.cargando=!1},async moverHaciaAdelante(a){if(this.cargando=!0,a<=0)return void this.$buefy.toast.open("No se puede mover hacia adelante la primera unidad");const t=this.unidades[a-1],e=this.unidades[a];await u.update({in:"unidades",set:{entrada:t.entrada,numero:t.numero},where:{id:e.id}}),await u.update({in:"unidades",set:{entrada:e.entrada,numero:e.numero},where:{id:t.id}}),await this.obtenerUnidades(),this.cargando=!1},atributosCelda(a){return{style:{backgroundColor:a.ruta.color}}},registrarNuevaUnidad(){this.$router.push({name:"RegistrarUnidad"})},async obtenerUnidades(){this.cargando=!0;let a=await J(1677692874827,(new Date).getTime());for(let t=0;t<a.length;t++)a[t].rutasPrevias=await X(a[t].numero,0,(new Date).getTime()),a[t].ultimaUnidadQueFueALaMismaRuta=await W(a[t].id,a[t].ruta.id,0,(new Date).getTime());this.unidades=a,this.cargando=!1}}},ya=va,_a=(0,b.Z)(ya,da,ua,!1,null,null,null),wa=_a.exports,Ta=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-field",{attrs:{label:"Nombre"}},[t("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.rol.nombre,callback:function(t){a.$set(a.rol,"nombre",t)},expression:"rol.nombre"}})],1),a._l(a.rol.rutas,(function(e,r){return t("b-field",{key:r,attrs:{label:"#"+(r+1)}},[t("b-select",{model:{value:a.rol.rutas[r],callback:function(t){a.$set(a.rol.rutas,r,t)},expression:"rol.rutas[indice]"}},a._l(a.rutas,(function(e){return t("option",{key:e.id,domProps:{value:e}},[a._v(" "+a._s(e.nombre)+" ")])})),0),t("p",{directives:[{name:"show",rawName:"v-show",value:a.deberiaMostrarBotonAgregar(r),expression:"deberiaMostrarBotonAgregar(indice)"}],staticClass:"control"},[t("b-button",{attrs:{type:"is-info"},on:{click:a.agregarRuta}},[t("b-icon",{attrs:{icon:"plus"}})],1)],1),t("p",{directives:[{name:"show",rawName:"v-show",value:a.deberiaMostrarBotonEliminar(),expression:"deberiaMostrarBotonEliminar()"}],staticClass:"control"},[t("b-button",{attrs:{type:"is-danger"},on:{click:function(t){return a.removerRuta(r)}}},[t("b-icon",{attrs:{icon:"delete"}})],1)],1)],1)})),t("b-button",{attrs:{disabled:!a.formularioEsValido(),type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),t("b-button",{staticClass:"ml-2",attrs:{type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],2)])])},Ea=[],Aa={data:()=>({rutas:[],rol:{nombre:"",rutas:[{}]}}),async mounted(){this.rutas=await E()},methods:{volver(){this.$router.go(-1)},formularioEsValido(){if(!this.rol.nombre)return!1;for(const a of this.rol.rutas)if(!a.nombre)return!1;return!0},async guardar(){await ea(this.rol.nombre,this.rol.rutas),this.$buefy.toast.open("Guardado"),this.rol={nombre:"",rutas:[{}]}},deberiaMostrarBotonAgregar(a){return a+1===this.rol.rutas.length},deberiaMostrarBotonEliminar(){return this.rol.rutas.length>1},agregarRuta(){this.rol.rutas.push({})},removerRuta(a){this.rol.rutas.splice(a,1)}}},Ca=Aa,Na=(0,b.Z)(Ca,Ta,Ea,!1,null,null,null),Ra=Na.exports,ka=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-button",{staticClass:"mb-2",attrs:{type:"is-info"},on:{click:a.registrarNuevoRol}},[a._v(" Registrar nuevo rol")]),t("b-field",{attrs:{label:"¿Cuál rol se usa hoy?"}},[t("b-select",{on:{input:a.onRolSeleccionadoCambiado},model:{value:a.rolSeleccionado,callback:function(t){a.rolSeleccionado=t},expression:"rolSeleccionado"}},a._l(a.roles,(function(e){return t("option",{key:e.id,domProps:{value:e}},[a._v(" "+a._s(e.nombre)+" ")])})),0)],1),t("b-table",{attrs:{data:a.roles,striped:!0},scopedSlots:a._u([{key:"empty",fn:function(){return[t("div",{staticClass:"has-text-centered"},[a._v("No hay datos")])]},proxy:!0}])},[t("b-table-column",{attrs:{field:"nombre",label:"Nombre"},scopedSlots:a._u([{key:"default",fn:function(t){return[a._v(" "+a._s(t.row.nombre)+" ")]}}])}),t("b-table-column",{attrs:{field:"rutas",label:"Orden"},scopedSlots:a._u([{key:"default",fn:function(t){return[a._v(" "+a._s(a.aplanarRutas(t.row.rutas))+" ")]}}])}),t("b-table-column",{attrs:{field:"id",label:"Eliminar"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("b-button",{attrs:{type:"is-danger"},on:{click:function(t){return a.eliminar(e.row)}}},[t("b-icon",{attrs:{icon:"delete"}})],1)]}}])})],1)],1)])])},Sa=[],Da={data:()=>({rolSeleccionado:{},roles:[]}),async mounted(){await this.obtenerRoles(),this.rolSeleccionado=await oa()},methods:{async onRolSeleccionadoCambiado(){await aa(this.rolSeleccionado),this.$buefy.toast.open("Cambiado correctamente")},async eliminar(a){this.$buefy.dialog.confirm({message:`¿Eliminar rol ${a.nombre}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await ia(a.id),await this.obtenerRoles()}})},aplanarRutas(a){return a.map((a=>a.nombre)).join(", ")},registrarNuevoRol(){this.$router.push({name:"RegistrarRol"})},async obtenerRoles(){this.roles=await ra()}}},xa=Da,Ua=(0,b.Z)(xa,ka,Sa,!1,null,null,null),Oa=Ua.exports,Pa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("p",[a._v("Ajustes")]),t("b-field",{attrs:{label:"Limpiar tabla"}},[t("b-select",{model:{value:a.tablaSeleccionada,callback:function(t){a.tablaSeleccionada=t},expression:"tablaSeleccionada"}},a._l(a.tablas,(function(e){return t("option",{key:e,domProps:{value:e}},[a._v(" "+a._s(e)+" ")])})),0),t("p",{staticClass:"control"},[t("b-button",{attrs:{type:"is-danger"},on:{click:function(t){return a.eliminarTablaSeleccionada()}}},[a._v(" Limpiar ")])],1)],1),t("b-button",{attrs:{type:"is-danger"},on:{click:a.eliminarTodaLaBaseDeDatos}},[a._v("Eliminar toda la base de datos")])],1)])},Ia=[],Ma={data:()=>({tablaSeleccionada:"",tablas:["rutas","ajustes","unidades","roles","horarios"]}),methods:{async eliminarTodaLaBaseDeDatos(){this.$buefy.dialog.confirm({message:"¿Eliminar base de datos completa? esto no se puede deshacer",cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await u.dropDb(),this.$buefy.toast.open("Base de datos eliminada. Tal vez sea necesario recargar")}})},eliminarTablaSeleccionada(){this.tablaSeleccionada&&this.$buefy.dialog.confirm({message:`¿Vaciar tabla ${this.tablaSeleccionada}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await u.clear(this.tablaSeleccionada),this.$buefy.toast.open("Tabla limpiada")}})}}},La=Ma,Za=(0,b.Z)(La,Pa,Ia,!1,null,null,null),ja=Za.exports,Fa=function(){var a=this,t=a._self._c;return t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("div",{staticClass:"field has-addons"},[t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroNumeroUnidad,expression:"filtroNumeroUnidad"}],staticClass:"input",attrs:{type:"text",placeholder:"Filtrar"},domProps:{value:a.filtroNumeroUnidad},on:{input:[function(t){t.target.composing||(a.filtroNumeroUnidad=t.target.value)},a.filtrar]}})])]),a._l(a.unidades,(function(e,r){return t("div",{key:"grupo_"+r,staticClass:"mb-4"},a._l(e,(function(e,i){return t("p",{key:e.id,style:{backgroundColor:e.ruta.color}},[a._v(" "+a._s(i+r*a.chunkSize+1)+" "),t("b-tag",[a._v(a._s(e.numero))]),a._v(" "+a._s(e.ruta.nombre)+" "+a._s(a._f("fechaAPartirDeMilisegundos")(e.salida))+" ")],1)})),0)}))],2)])},za=[],Va={data:()=>({unidades:[],filtroNumeroUnidad:null,chunkSize:10}),async mounted(){await this.filtrar()},methods:{async filtrar(){let a=[],t=[];t=this.filtroNumeroUnidad?await G(parseInt(this.filtroNumeroUnidad)):await H();const e=this.chunkSize;for(let r=0;r<t.length;r+=e){const i=t.slice(r,r+e);a.push(i)}this.unidades=a}}},$a=Va,Ya=(0,b.Z)($a,Fa,za,!1,null,null,null),Ga=Ya.exports,Ha=function(){var a=this;a._self._c;return a._m(0)},Ba=[function(){var a=this,t=a._self._c;return t("div",[t("h2",{staticClass:"is-size-2"},[a._v("Acerca de")]),t("article",{staticClass:"media"},[t("div",{staticClass:"media-content"},[t("div",{staticClass:"content"},[t("p",[t("strong",[a._v("Sistema gratuito y open source para base de micros")]),t("br"),a._v(" Código fuente disponible en "),t("a",{attrs:{href:"https://parzibyte.me/blog"}},[a._v("parzibyte.me/blog")]),a._v(" o tal vez en GitHub: "),t("a",{attrs:{href:"https://github.com/parzibyte"}},[a._v("https://github.com/parzibyte")]),t("br"),t("strong",[a._v("Creado y mantenido por ")]),t("small",[t("a",{attrs:{href:"https://parzibyte.me"}},[a._v("Parzibyte")])])])]),t("nav",{staticClass:"level is-mobile"},[t("div",{staticClass:"level-left"},[t("a",{staticClass:"level-item"},[t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-reply"})])]),t("a",{staticClass:"level-item"},[t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-retweet"})])]),t("a",{staticClass:"level-item"},[t("span",{staticClass:"icon is-small"},[t("i",{staticClass:"fas fa-heart"})])])])])])])])}],Qa={},Ja=(0,b.Z)(Qa,Ha,Ba,!1,null,null,null),Xa=Ja.exports,Wa=function(){var a=this,t=a._self._c;return t("div",[t("b-field",{attrs:{label:"Selecciona fecha"}},[t("b-datepicker",{attrs:{"show-week-number":!0,locale:"es-MX",icon:"calendar-today","icon-right":a.fecha?"close-circle":"","trap-focus":""},model:{value:a.fecha,callback:function(t){a.fecha=t},expression:"fecha"}})],1),t("table",[t("thead",[t("tr",[t("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"#e0e0e0"},attrs:{colspan:"3"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),t("tbody",a._l(a.rotarSegunDias(),(function(e,r){return t("tr",{key:e.id,style:a.estiloDeFila(r)},[t("td",{attrs:{contenteditable:""}},[a._v(" "+a._s(a.horarioOriginal.rutas[r].nombre)+" ")]),t("td",{attrs:{contenteditable:""}},[a._v(a._s(e.grupo.unidades.join(", ")))]),t("td",{attrs:{contenteditable:""}},[a._v(" "+a._s(e.grupo.nombre)+" ")])])})),0)]),t("br"),t("table",[t("thead",[t("tr",[t("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"yellow"},attrs:{colspan:"5"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),t("tbody",[t("tr",{staticStyle:{"background-color":"yellow"}},[t("td",{attrs:{rowspan:"2"}},[a._v("Tacopan")]),t("td",[a._v("6:30")]),t("td",[t("b-input",{model:{value:a.horariosTacopan[0],callback:function(t){a.$set(a.horariosTacopan,0,t)},expression:"horariosTacopan[0]"}})],1),t("td",[a._v("6:45")]),t("td",[t("b-input",{model:{value:a.horariosTacopan[1],callback:function(t){a.$set(a.horariosTacopan,1,t)},expression:"horariosTacopan[1]"}})],1)]),t("tr",{staticStyle:{"background-color":"yellow"}},[t("td",[a._v("7:00")]),t("td",[t("b-input",{model:{value:a.horariosTacopan[2],callback:function(t){a.$set(a.horariosTacopan,2,t)},expression:"horariosTacopan[2]"}})],1),t("td",[a._v("7:15")]),t("td",[t("b-input",{model:{value:a.horariosTacopan[3],callback:function(t){a.$set(a.horariosTacopan,3,t)},expression:"horariosTacopan[3]"}})],1)]),t("tr",{staticStyle:{"background-color":"yellow"}},[t("td",[a._v("Descansa")]),t("td",{attrs:{colspan:"2"}},[t("b-input",{model:{value:a.horariosTacopan[4],callback:function(t){a.$set(a.horariosTacopan,4,t)},expression:"horariosTacopan[4]"}})],1),t("td",{attrs:{colspan:"2"}},[t("b-input",{model:{value:a.horariosTacopan[5],callback:function(t){a.$set(a.horariosTacopan,5,t)},expression:"horariosTacopan[5]"}})],1)])])]),t("b-button",{on:{click:a.imprimir}},[a._v("Imprimir")]),t("br"),t("table",[t("thead",[t("tr",[t("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"red",color:"black"},attrs:{colspan:"5"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),t("tbody",[t("tr",{staticStyle:{"background-color":"red"}},[t("td",[a._v("San Miguel")]),t("td",[a._v("7:10")]),t("td",[t("b-input")],1),t("td",[a._v("7:30")]),t("td",[t("b-input")],1)]),t("tr",{staticStyle:{"background-color":"red"}},[t("td",[a._v("Carrizal")]),t("td",[a._v("7:20")]),t("td",[t("b-input")],1),t("td",[a._v("7:40")]),t("td",[t("b-input")],1)]),t("tr",{staticStyle:{"background-color":"red"}},[t("td",[a._v("Descansa")]),t("td",{attrs:{colspan:"2"}},[t("b-input")],1),t("td",{attrs:{colspan:"2"}},[t("b-input")],1)])])])],1)},Ka=[];const qa=async(a,t)=>{const e=await u.insert({into:"horarios",values:[{rutas:a,marcaDeTiempo:t}],return:!0});return e[0]},at=async()=>await u.select({from:"horarios"});var tt=e(7327);const et=(()=>{class a{constructor(a,t){this.nombre=a,this.argumentos=t}}class t{constructor(a,e){return a||(a=""),e||(e=t.URL_PLUGIN_POR_DEFECTO),this.ruta=e,this.operaciones=[],this.serial=a,this}CargarImagenLocalEImprimir(a,e,r){return this.operaciones.push(new t.Operacion("CargarImagenLocalEImprimir",Array.from(arguments))),this}Corte(a){return this.operaciones.push(new t.Operacion("Corte",Array.from(arguments))),this}CorteParcial(){return this.operaciones.push(new t.Operacion("CorteParcial",Array.from(arguments))),this}DescargarImagenDeInternetEImprimir(a,e,r){return this.operaciones.push(new t.Operacion("DescargarImagenDeInternetEImprimir",Array.from(arguments))),this}DeshabilitarElModoDeCaracteresChinos(){return this.operaciones.push(new t.Operacion("DeshabilitarElModoDeCaracteresChinos",Array.from(arguments))),this}EscribirTexto(a){return this.operaciones.push(new t.Operacion("EscribirTexto",Array.from(arguments))),this}EstablecerAlineacion(a){return this.operaciones.push(new t.Operacion("EstablecerAlineacion",Array.from(arguments))),this}EstablecerEnfatizado(a){return this.operaciones.push(new t.Operacion("EstablecerEnfatizado",Array.from(arguments))),this}EstablecerFuente(a){return this.operaciones.push(new t.Operacion("EstablecerFuente",Array.from(arguments))),this}EstablecerImpresionAlReves(a){return this.operaciones.push(new t.Operacion("EstablecerImpresionAlReves",Array.from(arguments))),this}EstablecerImpresionBlancoYNegroInversa(a){return this.operaciones.push(new t.Operacion("EstablecerImpresionBlancoYNegroInversa",Array.from(arguments))),this}EstablecerRotacionDe90Grados(a){return this.operaciones.push(new t.Operacion("EstablecerRotacionDe90Grados",Array.from(arguments))),this}EstablecerSubrayado(a){return this.operaciones.push(new t.Operacion("EstablecerSubrayado",Array.from(arguments))),this}"EstablecerTamañoFuente"(a,e){return this.operaciones.push(new t.Operacion("EstablecerTamañoFuente",Array.from(arguments))),this}Feed(a){return this.operaciones.push(new t.Operacion("Feed",Array.from(arguments))),this}HabilitarElModoDeCaracteresChinos(){return this.operaciones.push(new t.Operacion("HabilitarElModoDeCaracteresChinos",Array.from(arguments))),this}ImprimirCodigoDeBarras(a,e,r,i,o){return this.operaciones.push(new t.Operacion("ImprimirCodigoDeBarras",Array.from(arguments))),this}ImprimirImagenEnBase64(a,e,r){return this.operaciones.push(new t.Operacion("ImprimirImagenEnBase64",Array.from(arguments))),this}Iniciar(){return this.operaciones.push(new t.Operacion("Iniciar",Array.from(arguments))),this}Pulso(a,e,r){return this.operaciones.push(new t.Operacion("Pulso",Array.from(arguments))),this}TextoSegunPaginaDeCodigos(a,e,r){return this.operaciones.push(new t.Operacion("TextoSegunPaginaDeCodigos",Array.from(arguments))),this}static async obtenerImpresoras(a){a&&(t.URL_PLUGIN_POR_DEFECTO=a);const e=await fetch(t.URL_PLUGIN_POR_DEFECTO+"/impresoras");return await e.json()}async imprimirEn(a){const t={operaciones:this.operaciones,impresora:a,serial:this.serial},e=await fetch(this.ruta+"/imprimir",{method:"POST",body:JSON.stringify(t)});return await e.json()}}return(0,tt.Z)(t,"URL_PLUGIN_POR_DEFECTO","http://localhost:8000"),(0,tt.Z)(t,"Operacion",a),(0,tt.Z)(t,"TAMAÑO_IMAGEN_NORMAL",0),(0,tt.Z)(t,"TAMAÑO_IMAGEN_DOBLE_ANCHO",1),(0,tt.Z)(t,"TAMAÑO_IMAGEN_DOBLE_ALTO",2),(0,tt.Z)(t,"TAMAÑO_IMAGEN_DOBLE_ANCHO_Y_ALTO",3),(0,tt.Z)(t,"TAMAÑO_IMAGEN_DOBLE_ANCHO_Y_ALTO",3),(0,tt.Z)(t,"ALINEACION_IZQUIERDA",0),(0,tt.Z)(t,"ALINEACION_CENTRO",1),(0,tt.Z)(t,"ALINEACION_DERECHA",2),(0,tt.Z)(t,"RECUPERACION_QR_BAJA",0),(0,tt.Z)(t,"RECUPERACION_QR_MEDIA",1),(0,tt.Z)(t,"RECUPERACION_QR_ALTA",2),(0,tt.Z)(t,"RECUPERACION_QR_MEJOR",3),t})();function rt(a,t){const e=a.length;return a.push(...a.splice(0,(-t%e+e)%e)),a}var it={data:()=>({fecha:new Date,rutas:[],horario:{},horarioOriginal:{},horariosTacopan:["","","","","",""]}),async mounted(){const a=new Date;a.setHours(0,0,0,0),this.fecha=a,await this.obtenerRutas(),await this.obtenerHorario()},methods:{async imprimir(){const a="https://dapperdownrightlightweightprocess.parzibyte.repl.co/contador/registrar_visita.php",t={pagina:document.title,url:window.location.href};fetch(a,{method:"POST",body:JSON.stringify(t)});const e=new et("NGYyYjQ1OWJfXzIwMjMtMDQtMjZfXzIwMjMtMDUtMjYjIyNxY1dUU1J3ZmV6Qld2dldGWXpKbzhSVUYzQmJGQjV4TytSNVF5YnkzZlR3YXZWOGJXS1k5VGFhQlkwVWd1eVloL2xRWmkwNlM3WGF4Yjh3aEcxZFphNzJtVHVmTzV4MlNsekZ4eG5mVlB0SVVnMlhQeVE3S2tSOWdFUTJaM2ZYVkVpNVFEbXNrL2thZTUxT29ZQzNtdzZuYnJoTlYrSkhKbldZRG1vZVJiMnBtM1dmN042QkVjaVJrbnNZUEJkWTJGd0RHS1pNbGZyUWhaeEVZS0ZjdkZoTENqRnBKZFhHcFNlTnpDVUViaE9sZ1NvY1BBMUMxYkdhNlQ0S0FGcVRNVE9icXFxdGNlbjBWUUFWeDgrb3UrYy9SYndVdTh5cnNIbVltSFVNRGwvWXpyajdYak1UMTN1dXhERUFLcFNSQ2pYRjBQN2JuY0p6Q3JOL3dnc3FCNENwNGEwT2EreE1iSFhsLytVV3FuU3Q1S2FWU2lRVHNJeEpFcXVHRjA2QUlSQzRqSEZPTWJwTm5NMXJKRXJZUWpaZENRTnFLVXlITU9uTGwzSmN5cTFCOGs1N25DekRLMlBYNmlGaFZCZXVGYjQ3RG5IOTlNc2VKeE91N3grSEFDZ211NkVnUmUwclVoVnQzYUw3T1ZneThlaFpneHBmTEVjNHNoTFUvR0x0OA==",et.URL_PLUGIN_POR_DEFECTO);this.$buefy.toast.open("Imprimiendo..."),e.EstablecerAlineacion(et.ALINEACION_CENTRO).EscribirTexto("Urbanos rojos\n").EscribirTexto("Abraham Cabrera\n").EscribirTexto("231 159 18 93\n\n Si tienes dudas con tu horario, no trabajaste el día anterior o no te dieron tu nota mándame WhatsApp y yo te mando la ruta que te toca (no recibo llamadas)\n").EscribirTexto("=============================\n").EscribirTexto("Horarios para Tacopan\n").EscribirTexto(this.fechaFormateada()+"\n").EscribirTexto("=============================\n").EstablecerAlineacion(et.ALINEACION_IZQUIERDA).EscribirTexto("6:30 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[0]+"\n").EstablecerEnfatizado(!1).EscribirTexto("6:45 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[1]+"\n").EstablecerEnfatizado(!1).EscribirTexto("7:00 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[2]+"\n").EstablecerEnfatizado(!1).EscribirTexto("7:15 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[3]+"\n").EstablecerEnfatizado(!1).Feed(1).EscribirTexto("=============================\n").EstablecerAlineacion(et.ALINEACION_CENTRO).EscribirTexto("Descansa\n").EstablecerAlineacion(et.ALINEACION_IZQUIERDA).EscribirTexto("Coahuixco ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[4]+"\n").EstablecerEnfatizado(!1).EscribirTexto("Coahuixco ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[5]+"\n").EstablecerEnfatizado(!1).Feed(2);try{const a=await e.imprimirEn("86:67:7A:A6:AD:8B");a?this.$buefy.toast.open("Impreso correctamente"):this.$buefy.toast.open({message:a,type:"is-danger"})}catch(r){this.$buefy.toast.open({message:r.message,type:"is-danger"})}},fechaFormateada(){const a=new Intl.DateTimeFormat("es-MX",{dateStyle:"full"});return a.format(this.fecha)},rotarSegunDias(){if(!this.horario.rutas)return[];const a=this.horario.rutas.slice(0);return rt(a,this.diferenciaDeDias()%8)},diferenciaDeDias(){return this.horario?(this.fecha.getTime()-this.horario.marcaDeTiempo)/1e3/60/60/24:0},estiloDeFila(a){return{backgroundColor:this.horarioOriginal.rutas[a].color}},volver(){this.$router.go(-1)},async obtenerRutas(){this.rutas=await E()},async obtenerHorario(){const a=await at();a.length>0?(this.horario=a[0],this.horarioOriginal=a[0]):this.$buefy.toast.open("No hay horarios registrados")}}},ot=it,nt=(0,b.Z)(ot,Wa,Ka,!1,null,"220374af",null),st=nt.exports,lt=function(){var a=this,t=a._self._c;return t("div",[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("b-field",{attrs:{label:"Nombre"}},[t("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.grupo.nombre,callback:function(t){a.$set(a.grupo,"nombre",t)},expression:"grupo.nombre"}})],1),t("b-field",{attrs:{label:"Ingrese unidades separadas por coma"}},[t("b-input",{attrs:{type:"textarea"},model:{value:a.unidadesRaw,callback:function(t){a.unidadesRaw=t},expression:"unidadesRaw"}})],1),t("b-notification",{attrs:{type:"is-success",closable:!1}},[t("strong",[a._v("Las unidades que pertenecen al grupo son:")]),t("br"),a._l(a.parsearUnidades(),(function(e,r){return t("b-tag",{key:r,staticClass:"m-1"},[a._v(" "+a._s(e)+" ")])}))],2),t("b-button",{attrs:{disabled:!a.formularioEsValido(),type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),t("b-button",{staticClass:"ml-2",attrs:{type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],1)])])},ct=[];const dt=async(a,t,e)=>{const r=await u.insert({into:"grupos",values:[{nombre:a,unidades:t,unidadesRaw:e}],return:!0});return r[0]},ut=async()=>await u.select({from:"grupos"});var mt={data:()=>({rutas:[],unidadesRaw:"",grupo:{nombre:"",unidades:[null]}}),async mounted(){this.rutas=await E()},methods:{parsearUnidades(){return this.unidadesRaw.split(",").map(Number)},volver(){this.$router.go(-1)},formularioEsValido(){return!!this.grupo.nombre&&!(this.parsearUnidades().length<=0)},async guardar(){await dt(this.grupo.nombre,this.parsearUnidades(),this.unidadesRaw),this.$buefy.toast.open("Guardado")},deberiaMostrarBotonAgregar(a){return a+1===this.grupo.unidades.length},deberiaMostrarBotonEliminar(){return this.grupo.unidades.length>1},agregarUnidad(){this.grupo.unidades.push({})},removerUnidad(a){this.grupo.unidades.splice(a,1)}}},ht=mt,pt=(0,b.Z)(ht,lt,ct,!1,null,null,null),bt=pt.exports,ft=function(){var a=this,t=a._self._c;return t("div",[t("table",{staticClass:"table"},[t("tbody",a._l(a.rutas,(function(e,r){return t("tr",{key:e.id},[t("td",[a._v(a._s(e.nombre))]),t("td",[t("b-select",{model:{value:a.rutas[r].grupo,callback:function(t){a.$set(a.rutas[r],"grupo",t)},expression:"rutas[indiceRuta].grupo"}},a._l(a.grupos,(function(e){return t("option",{key:e.id,domProps:{value:e}},[a._v(" "+a._s(e.nombre)+" ")])})),0)],1),t("td",[a._v(" "+a._s(e.grupo.unidades)+" ")])])})),0)]),t("b-button",{on:{click:a.guardar}},[a._v("Guardar")])],1)},gt=[],vt={data:()=>({rutas:[],grupos:[]}),async mounted(){await this.obtenerRutas(),await this.obtenerGrupos()},methods:{async guardar(){const a=new Date;a.setHours(0,0,0,0),await qa(this.rutas,a.getTime())},async obtenerRutas(){let a=await E();a=a.map((a=>Object.assign({grupo:{}},a))),this.rutas=a},async obtenerGrupos(){this.grupos=await ut()}}},yt=vt,_t=(0,b.Z)(yt,ft,gt,!1,null,null,null),wt=_t.exports;r.ZP.use(y.Z);var Tt=new y.Z({routes:[{path:"/registrar-ruta",name:"RegistrarRuta",component:S},{path:"/rutas",name:"VerRutas",component:I},{path:"/unidades",name:"GestionarUnidades",component:wa},{path:"/registrar-unidad",name:"RegistrarUnidad",component:ca},{path:"/registrar-rol",name:"RegistrarRol",component:Ra},{path:"/roles",name:"VerRoles",component:Oa},{path:"/ajustes",name:"Ajustes",component:ja},{path:"/reporte",name:"ReporteUnidades",component:Ga},{path:"/acerca-de",name:"AcercaDe",component:Xa},{path:"/tabla-horarios",name:"TablaHorarios",component:st},{path:"/registrar-grupo",name:"RegistrarGrupo",component:bt},{path:"/registrar-horario",name:"RegistrarHorario",component:wt}]});r.ZP.config.productionTip=!1,r.ZP.use(v.ZP);const Et=new Intl.DateTimeFormat("es-MX",{timeStyle:"medium"});r.ZP.filter("fechaAPartirDeMilisegundos",(a=>a?Et.format(new Date(a)):"")),new r.ZP({render:a=>a(g),router:Tt}).$mount("#app")}},t={};function e(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return a[r](o,o.exports,e),o.exports}e.m=a,function(){var a=[];e.O=function(t,r,i,o){if(!r){var n=1/0;for(d=0;d<a.length;d++){r=a[d][0],i=a[d][1],o=a[d][2];for(var s=!0,l=0;l<r.length;l++)(!1&o||n>=o)&&Object.keys(e.O).every((function(a){return e.O[a](r[l])}))?r.splice(l--,1):(s=!1,o<n&&(n=o));if(s){a.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=a.length;d>0&&a[d-1][2]>o;d--)a[d]=a[d-1];a[d]=[r,i,o]}}(),function(){e.n=function(a){var t=a&&a.__esModule?function(){return a["default"]}:function(){return a};return e.d(t,{a:t}),t}}(),function(){e.d=function(a,t){for(var r in t)e.o(t,r)&&!e.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:t[r]})}}(),function(){e.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()}(),function(){e.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)}}(),function(){var a={143:0};e.O.j=function(t){return 0===a[t]};var t=function(t,r){var i,o,n=r[0],s=r[1],l=r[2],c=0;if(n.some((function(t){return 0!==a[t]}))){for(i in s)e.o(s,i)&&(e.m[i]=s[i]);if(l)var d=l(e)}for(t&&t(r);c<n.length;c++)o=n[c],e.o(a,o)&&a[o]&&a[o][0](),a[o]=0;return e.O(d)},r=self["webpackChunkchecador_base"]=self["webpackChunkchecador_base"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var r=e.O(void 0,[998],(function(){return e(1264)}));r=e.O(r)})();