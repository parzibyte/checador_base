(function(){"use strict";var a={2149:function(a,e,t){var r=t(6369),i=function(){var a=this,e=a._self._c;return e("div",[e("b-navbar",{attrs:{type:"is-primary"},scopedSlots:a._u([{key:"start",fn:function(){return[e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"VerRutas"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"routes"}}),a._v(" Rutas")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"GestionarUnidades"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"bus-multiple"}}),a._v(" Unidades")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"VerRoles"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"sync"}}),a._v(" Roles")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"Ajustes"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"cog"}}),a._v(" Ajustes")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"ReporteUnidades"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Reporte")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"RegistrarGrupo"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Registrar grupo")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"RegistrarHorario"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Registrar horario")],1),e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"TablaHorarios"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"table"}}),a._v(" Tabla ")],1)]},proxy:!0},{key:"end",fn:function(){return[e("b-navbar-item",{attrs:{tag:"router-link",to:{name:"AcercaDe"}}},[e("b-icon",{staticClass:"mr-1",attrs:{icon:"code-braces"}}),a._v(" Acerca de")],1)]},proxy:!0}])}),e("section",{staticClass:"section",staticStyle:{padding:"0.1rem"}},[e("router-view")],1)],1)},o=[],n=t(442),s=t.n(n),l=t(6867);const c=()=>{const a={name:"unidades",columns:{id:{primaryKey:!0,autoIncrement:!0,dataType:l.DATA_TYPE.Number},idRuta:{notNull:!0,dataType:l.DATA_TYPE.Number},prioridad:{autoIncrement:!0,dataType:l.DATA_TYPE.Number},numero:{notNull:!0,dataType:l.DATA_TYPE.Number},entrada:{dataType:l.DATA_TYPE.Number,notNull:!0},horaLlamada:{dataType:l.DATA_TYPE.Number,default:0},salida:{dataType:l.DATA_TYPE.Number,default:0},segundosDesdeSalidaAnterior:{notNull:!0,dataType:l.DATA_TYPE.Number,default:0},esEspecial:{notNull:!0,dataType:l.DATA_TYPE.Boolean,default:!1},ruta:{dataType:l.DATA_TYPE.Object,notNull:!0}}},e={name:"rutas",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},color:{notNull:!0,dataType:l.DATA_TYPE.String},mensajeLlamada:{dataType:l.DATA_TYPE.String,notNull:!0},mensajeSalida:{dataType:l.DATA_TYPE.String,notNull:!0}}},t={name:"roles",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},rutas:{notNull:!0,dataType:l.DATA_TYPE.Array}}},r={name:"ajustes",columns:{id:{primaryKey:!0,autoIncrement:!0},rolSeleccionado:{notNull:!0,dataType:l.DATA_TYPE.Object}}},i={name:"grupos",columns:{id:{primaryKey:!0,autoIncrement:!0},nombre:{notNull:!0,dataType:l.DATA_TYPE.String},unidadesRaw:{notNull:!0,dataType:l.DATA_TYPE.String},unidades:{notNull:!0,dataType:l.DATA_TYPE.Array}}},o={name:"horarios",columns:{id:{primaryKey:!0,autoIncrement:!0},rutas:{notNull:!0,dataType:l.DATA_TYPE.Array},marcaDeTiempo:{notNull:!0,dataType:l.DATA_TYPE.Number}}},n={name:"checador",tables:[a,e,t,r,i,o]};return n},d=new l.Connection;d.addPlugin(s());var u=d;const m=async()=>{const a=c();return await d.initDb(a)};var h={name:"app",async beforeCreate(){const a=await m();console.log({ok:a})}},p=h,b=t(3736),f=(0,b.Z)(p,i,o,!1,null,null,null),v=f.exports,g=t(9515),y=(t(387),t(2631)),_=function(){var a=this,e=a._self._c;return e("div",[e("b-field",{attrs:{label:"Nueva ruta"}},[e("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.nombre,callback:function(e){a.nombre=e},expression:"nombre"}})],1),e("b-field",{attrs:{label:"Color"}},[e("b-colorpicker",{model:{value:a.color,callback:function(e){a.color=e},expression:"color"}})],1),e("b-field",{attrs:{label:"Mensaje de sonido(opcional)"}},[e("b-input",{attrs:{type:"textarea"},model:{value:a.mensajeLlamada,callback:function(e){a.mensajeLlamada=e},expression:"mensajeLlamada"}})],1),e("b-button",{attrs:{type:"is-info"},on:{click:a.guardar}},[a._v("Guardar")]),e("b-button",{staticClass:"ml-2",attrs:{type:"is-primary"},on:{click:a.volver}},[a._v("Volver")])],1)},w=[];const T=async(a,e,t,r)=>{const i=await u.insert({into:"rutas",values:[{nombre:a,color:e,mensajeLlamada:t,mensajeSalida:r}],return:!0});return i[0]},E=async()=>await u.select({from:"rutas"}),A=async a=>await u.remove({from:"rutas",where:{id:a}});var C=t(3352),k={data:()=>({nombre:"",color:C.ZP.parse("#8bc34a"),mensajeSalida:"",mensajeLlamada:""}),methods:{volver(){this.$router.go(-1)},async guardar(){this.nombre&&(await T(this.nombre,this.color.toString(),this.mensajeLlamada,this.mensajeSalida),this.nombre=this.mensajeLlamada=this.mensajeSalida="",this.color=C.ZP.parse("#8bc34a"),this.$buefy.toast.open("Guardada"))}}},R=k,D=(0,b.Z)(R,_,w,!1,null,null,null),S=D.exports,N=function(){var a=this,e=a._self._c;return e("div",[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-button",{staticClass:"mb-2",attrs:{type:"is-info"},on:{click:a.registrarNuevaRuta}},[a._v("Registrar nueva")]),e("b-table",{attrs:{data:a.rutas,striped:!0},scopedSlots:a._u([{key:"empty",fn:function(){return[e("div",{staticClass:"has-text-centered"},[a._v("No hay datos")])]},proxy:!0}])},[e("b-table-column",{attrs:{"td-attrs":a.atributosCelda,field:"color",label:"Color"}},[a._v("   ")]),e("b-table-column",{attrs:{field:"nombre",label:"Nombre"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v(" "+a._s(e.row.nombre)+" ")]}}])}),e("b-table-column",{attrs:{field:"mensajeLlamada",label:"Mensaje de llamada"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v(" "+a._s(e.row.mensajeLlamada)+" ")]}}])}),e("b-table-column",{attrs:{field:"mensajeSalida",label:"Mensaje de salida"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v(" "+a._s(e.row.mensajeSalida)+" ")]}}])}),e("b-table-column",{attrs:{field:"id",label:"Eliminar"},scopedSlots:a._u([{key:"default",fn:function(t){return[e("b-button",{attrs:{type:"is-danger"},on:{click:function(e){return a.eliminar(t.row)}}},[e("b-icon",{attrs:{icon:"delete"}})],1)]}}])})],1)],1)])])},x=[],U=(t(7658),{data:()=>({rutas:[]}),async mounted(){await this.obtenerRutas()},methods:{atributosCelda(a){return{style:{backgroundColor:a.color}}},registrarNuevaRuta(){this.$router.push({name:"RegistrarRuta"})},async obtenerRutas(){this.rutas=await E()},async eliminar(a){this.$buefy.dialog.confirm({message:`¿Eliminar ruta ${a.nombre}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await A(a.id),await this.obtenerRutas()}})}}}),O=U,M=(0,b.Z)(O,N,x,!1,null,null,null),I=M.exports,P=function(){var a=this,e=a._self._c;return e("div",[e("div",{staticClass:"container"},[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Hora"}},[e("b-timepicker",{attrs:{rounded:"",icon:"clock","enable-seconds":!0,"hour-format":"24",locale:"es-MX"},model:{value:a.unidad.hora,callback:function(e){a.$set(a.unidad,"hora",e)},expression:"unidad.hora"}})],1),e("b-field",{attrs:{label:"Ruta"}},[e("b-select",{attrs:{expanded:""},model:{value:a.unidad.ruta,callback:function(e){a.$set(a.unidad,"ruta",e)},expression:"unidad.ruta"}},a._l(a.rutas,(function(t){return e("option",{key:t.id,domProps:{value:t}},[a._v(" "+a._s(t.nombre)+" ")])})),0)],1),e("b-field",{attrs:{label:"Número de unidad"}},[e("b-input",{model:{value:a.unidad.numero,callback:function(e){a.$set(a.unidad,"numero",a._n(e))},expression:"unidad.numero"}})],1),e("teclado-numerico",{on:{teclaPresionada:a.onTeclaPresionada,borrar:a.onTeclaBorrada,borrarTodo:a.onBorrarTodo}}),e("b-button",{attrs:{size:"is-large",type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),e("b-button",{staticClass:"ml-2",attrs:{size:"is-large",type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],1)])])])},L=[],Z=function(){var a=this,e=a._self._c;return e("div",{staticClass:"has-text-centered",staticStyle:{"max-width":"300px"}},[a._l(a.teclado,(function(t){return e("b-button",{key:t,staticClass:"m-2",attrs:{size:"is-large",type:"is-primary"},on:{click:function(e){return a.teclaPresionada(t)}}},[a._v(a._s(t))])})),e("b-button",{staticClass:"m-2",attrs:{size:"is-large",type:"is-warning"},on:{click:a.borrar}},[e("b-icon",{attrs:{icon:"backspace"}})],1),e("b-button",{staticClass:"m-2",attrs:{size:"is-large",type:"is-danger"},on:{click:a.borrarTodo}},[a._v("C")])],2)},j=[],z={data:()=>({teclado:"1234567890".split("")}),methods:{borrarTodo(){this.$emit("borrarTodo")},teclaPresionada(a){this.$emit("teclaPresionada",a)},borrar(){this.$emit("borrar")}}},F=z,$=(0,b.Z)(F,Z,j,!1,null,null,null),V=$.exports;const G=async(a,e,t)=>{const r=await u.select({from:"unidades",limit:1,where:{numero:a,entrada:{"-":{low:e,high:t}},salida:0}});return r.length>0?r[0]:{}},B=async a=>await u.select({from:"unidades",where:{salida:{"!=":0},numero:a},order:{by:"salida",type:"asc"}}),H=async()=>await u.select({from:"unidades",where:{salida:{"!=":0}},order:{by:"salida",type:"asc"}}),Y=async(a,e,t,r)=>{r=r||!1;const i=await u.insert({into:"unidades",values:[{idRuta:t.id,numero:a,entrada:e,ruta:t,esEspecial:r,salida:0,segundosDesdeSalidaAnterior:0,horaLlamada:0}],return:!0});return i[0]},W=async a=>await u.update({in:"unidades",set:{horaLlamada:(new Date).getTime()},where:{id:a}}),Q=async(a,e)=>await u.select({from:"unidades",where:{entrada:{"-":{low:a,high:e}},salida:0},order:{by:"prioridad",type:"asc"}}),J=async(a,e,t)=>await u.select({from:"unidades",where:{entrada:{"-":{low:e,high:t}},salida:{"!=":0},numero:a},order:{by:"salida",type:"desc"}}),X=async(a,e,t,r)=>{const i=await u.select({from:"unidades",limit:1,where:{id:{"!=":a},entrada:{"-":{low:t,high:r}},horaLlamada:{"!=":0},idRuta:e},order:{by:"horaLlamada",type:"desc"}});return i.length>0?i[0]:{}},K=async(a,e)=>await u.count({from:"unidades",where:{entrada:{"-":{low:a,high:e}},esEspecial:!0}}),q=async(a,e)=>await u.count({from:"unidades",where:{entrada:{"-":{low:a,high:e}}}}),aa=async a=>{await u.remove({from:"ajustes"});const e=await u.insert({into:"ajustes",values:[{rolSeleccionado:a}],return:!0});return e[0]},ea=async()=>{const a=await u.select({from:"ajustes"});return Array.isArray(a)&&a.length>0?a[0]:{}},ta=async(a,e)=>{const t=await u.insert({into:"roles",values:[{nombre:a,rutas:e}],return:!0});return t[0]},ra=async()=>await u.select({from:"roles"}),ia=async a=>await u.remove({from:"roles",where:{id:a}}),oa=async()=>{const a=await ea();return a.rolSeleccionado};var na={props:["esHijo"],components:{TecladoNumerico:V},data:()=>({unidad:{hora:new Date,numero:null,ruta:null},rutas:[],rolSeleccionado:{}}),async mounted(){this.rutas=await E(),this.rolSeleccionado=await oa(),this.elegirRutaAutomaticamenteSegunRol(),this.refrescarHora()},methods:{volver(){this.$router.go(-1)},async elegirRutaAutomaticamenteSegunRol(){if(!this.rolSeleccionado)return void this.$buefy.toast.open("No hay ningún rol seleccionado, imposible determinar ruta automáticamente");const a=await q(0,(new Date).getTime()),e=await K(0,(new Date).getTime());let t=(a-e)%this.rolSeleccionado.rutas.length;const r=this.rolSeleccionado.rutas[t];this.unidad.ruta=r},async guardar(){if(!this.unidad.numero)return;if(!this.unidad.ruta)return;if(this.esHijo)return void this.$emit("guardado",this.unidad);const a=await G(this.unidad.numero,0,(new Date).getTime());if(a.numero)return this.$buefy.toast.open({message:"La unidad ya está dentro de la base",type:"is-danger"}),void this.volver();await Y(this.unidad.numero,this.unidad.hora.getTime(),this.unidad.ruta,!1),this.$buefy.toast.open("Guardada"),this.unidad={hora:new Date,numero:null,ruta:null},this.$router.push({name:"GestionarUnidades"})},onBorrarTodo(){this.unidad.numero=null},refrescarHora(){this.unidad.hora=new Date,setTimeout(this.refrescarHora,500)},onTeclaPresionada(a){let e="";this.unidad.numero&&(e=this.unidad.numero.toString()),e+=a,this.unidad.numero=parseInt(e)},onTeclaBorrada(){let a="";this.unidad.numero&&(a=this.unidad.numero.toString()),a=a.split("").slice(0,-1).join(""),this.unidad.numero=a?parseInt(a):null}}},sa=na,la=(0,b.Z)(sa,P,L,!1,null,null,null),ca=la.exports,da=function(){var a=this,e=a._self._c;return e("div",[e("b-modal",{attrs:{active:a.mostrarModalAgregarUnidad,"aria-modal":"","aria-role":"dialog","has-modal-card":"","destroy-on-hide":!0,"trap-focus":""},on:{"update:active":function(e){a.mostrarModalAgregarUnidad=e}}},[e("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[e("section",{staticClass:"modal-card-body"},[e("registrar-unidad",{attrs:{esHijo:!0},on:{guardado:a.onUnidadAgregadaAdelante}})],1),e("footer",{staticClass:"modal-card-foot"},[e("b-button",{on:{click:function(e){return a.cerrarModalAgregarUnidad()}}},[a._v("Cancelar")])],1)])]),e("b-modal",{attrs:{active:a.mostrarModalSeleccionarRuta,"has-modal-card":"","destroy-on-hide":!0,"trap-focus":""},on:{"update:active":function(e){a.mostrarModalSeleccionarRuta=e}}},[e("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[e("section",{staticClass:"modal-card-body"},[e("seleccionador-de-rutas",{on:{seleccionada:a.onRutaSeleccionada}})],1),e("footer",{staticClass:"modal-card-foot"},[e("b-button",{on:{click:function(e){return a.cerrarModalSeleccionarRuta()}}},[a._v("Cancelar")])],1)])]),e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-button",{staticClass:"mb-1",attrs:{size:"is-small",type:"is-info"},on:{click:a.registrarNuevaUnidad}},[a._v("Registrar nueva")]),a._l(a.unidades,(function(t,r){return e("div",{key:t.id,staticStyle:{"margin-bottom":"0.1rem",padding:"0"},style:{backgroundColor:t.ruta.color}},[e("p",[e("span",{staticClass:"is-size-4"},[a._v(a._s(r+1)+"     "+a._s(t.numero)+" "+a._s(t.ruta.nombre)+" ")]),e("b-tag",{directives:[{name:"show",rawName:"v-show",value:t.horaLlamada,expression:"unidad.horaLlamada"}],staticClass:"ml-1",staticStyle:{"font-size":"1rem"},attrs:{icon:"phone",type:a.tipoDeTagParaTiempoTranscurrido(t.horaLlamada)}},[a._v(" "+a._s(a._f("fechaAPartirDeMilisegundos")(a.transcurrido(t.horaLlamada)))+" ")]),e("b-tag",{directives:[{name:"show",rawName:"v-show",value:!t.horaLlamada,expression:"!unidad.horaLlamada"}],staticClass:"ml-2",staticStyle:{"font-size":"1rem"},attrs:{icon:"arrow-up-thin",type:a.colorParaTagDePrediccion(r)}},[a._v(" "+a._s(a._f("fechaAPartirDeMilisegundos")(a.calcularSalida(r)))+" ")]),e("b-dropdown",{scopedSlots:a._u([{key:"trigger",fn:function({active:a}){return[e("b-button",{staticClass:"ml-1",attrs:{size:"is-small",type:"is-warning "}},[e("b-icon",{attrs:{icon:"dots-horizontal"}})],1)]}}],null,!0)},[e("b-dropdown-item",{staticClass:"has-text-centered"},[a._v(" Unidad "),e("strong",[a._v(a._s(t.numero)+" ")]),a._v(" para "),e("strong",[a._v(" "+a._s(t.ruta.nombre))])]),e("b-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:!t.horaLlamada&&0===r,expression:"!unidad.horaLlamada && indice === 0"}],on:{click:function(e){return a.llamar(t)}}},[a._v("Llamar")]),e("b-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:t.horaLlamada,expression:"unidad.horaLlamada"}],on:{click:function(e){return a.darSalida(r)}}},[a._v("Dar salida")]),e("b-dropdown-item",{on:{click:function(e){return a.moverHaciaAdelante(r)}}},[a._v("Mover número hacia adelante")]),e("b-dropdown-item",{on:{click:function(e){return a.moverRutaHaciaAdelante(r)}}},[a._v("Mover ruta hacia adelante")]),e("b-dropdown-item",{on:{click:function(e){return a.eliminarDeLaLista(r)}}},[a._v("Eliminar de la lista")]),e("b-dropdown-item",{on:{click:function(e){return a.moverAlFondo(r)}}},[a._v("Mover al fondo")]),e("b-dropdown-item",{on:{click:function(e){return a.agregarUnidadAdelante(r)}}},[a._v("Tepepan")]),e("b-dropdown-item",{on:{click:function(e){return a.tacopan(r)}}},[a._v("Tacopan")])],1),e("b-button",{directives:[{name:"show",rawName:"v-show",value:0===r,expression:"indice === 0"}],staticClass:"ml-1",attrs:{size:"is-small"},on:{click:function(e){return a.hablar(t.ruta.mensajeLlamada,t)}}},[e("b-icon",{attrs:{icon:"bullhorn"}})],1)],1),e("span",[a._v(" "+a._s(t.ultimaUnidadQueFueALaMismaRuta.numero)+" ("+a._s(a._f("fechaAPartirDeMilisegundos")(t.ultimaUnidadQueFueALaMismaRuta.salida))+") ")]),a._l(t.rutasPrevias,(function(t,r){return e("span",{key:r,staticStyle:{height:"1rem",border:"1px solid black"},style:{backgroundColor:t.ruta.color}},[a._v("       ")])}))],2)}))],2)])],1)},ua=[],ma=function(){var a=this,e=a._self._c;return e("b-field",[e("b-select",{attrs:{expanded:""},model:{value:a.ruta,callback:function(e){a.ruta=e},expression:"ruta"}},a._l(a.rutas,(function(t){return e("option",{key:t.id,domProps:{value:t}},[a._v(" "+a._s(t.nombre)+" ")])})),0),e("p",{staticClass:"control"},[e("b-button",{attrs:{type:"is-primary",label:"Ok"},on:{click:a.guardar}})],1)],1)},ha=[],pa={data:()=>({rutas:[],ruta:{}}),async mounted(){this.rutas=await E()},methods:{guardar(){this.ruta.id&&this.$emit("seleccionada",this.ruta)}}},ba=pa,fa=(0,b.Z)(ba,ma,ha,!1,null,null,null),va=fa.exports,ga={components:{RegistrarUnidad:ca,SeleccionadorDeRutas:va},data:()=>({cargando:!1,unidades:[],horaActual:new Date,idTimeout:null,mostrarModalAgregarUnidad:!1,mostrarModalSeleccionarRuta:!1,indiceUnidadEditada:{}}),async mounted(){this.refrescarHora(),await this.obtenerUnidades()},beforeDestroy(){clearTimeout(this.idTimeout)},methods:{hablar(a,e){if(!a)return;const t={"{nombreRuta}":e.ruta.nombre,"{numeroUnidad}":e.numero};let r=a;for(const[o,n]of Object.entries(t))r=r.replaceAll(o,n);let i=new SpeechSynthesisUtterance(r);speechSynthesis.speak(i)},colorParaTagDePrediccion(a){const e=this.calcularSalida(a),t=new Date(e),r=new Date,i=r.getFullYear(),o=r.getMonth(),n=r.getDate(),s=[{color:"is-warning",minutos:[15,45]},{color:"is-danger",horarios:[new Date(i,o,n,10,30,0,0),new Date(i,o,n,12,30,0,0),new Date(i,o,n,14,30,0,0),new Date(i,o,n,16,30,0,0),new Date(i,o,n,19,0,0,0)]}];for(const l of s){if(l.minutos)for(const a of l.minutos){const r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),a,0),i=(r-e)/1e3/60;if(i>=0&&i<=5)return l.color}if(l.horarios)for(const a of l.horarios){const t=(a-e)/1e3/60;if(t>=0&&t<=5)return l.color}}return"is-info"},async onRutaSeleccionada(a){const e=this.indiceUnidadEditada,t=this.unidades[e];await u.update({in:"unidades",set:{ruta:a,esEspecial:!0,idRuta:a.id},where:{id:t.id}});for(let r=e+1;r<this.unidades.length;r++)await u.update({in:"unidades",set:{ruta:this.unidades[r-1].ruta,idRuta:a.id},where:{id:this.unidades[r].id}});await this.obtenerUnidades(),this.cerrarModalSeleccionarRuta()},cerrarModalSeleccionarRuta(){this.mostrarModalSeleccionarRuta=!1},calcularSalida(a){if(this.unidades.length<=0)return 0;const e=this.unidades[0];return e.horaLlamada?e.horaLlamada+1e3*a*60*2.5:0},async tacopan(a){this.indiceUnidadEditada=a,this.mostrarModalSeleccionarRuta=!0},async onUnidadAgregadaAdelante(a){const e=this.unidades[this.indiceUnidadEditada];this.mostrarModalAgregarUnidad=!1;const t=await Y(a.numero,a.hora.getTime(),a.ruta,!0);await u.update({in:"unidades",set:{prioridad:e.prioridad},where:{id:t.id}});for(let r=this.indiceUnidadEditada;r<this.unidades.length;r++)await u.update({in:"unidades",set:{prioridad:this.unidades[r].prioridad+1},where:{id:this.unidades[r].id}});await this.obtenerUnidades()},cerrarModalAgregarUnidad(){this.mostrarModalAgregarUnidad=!1},agregarUnidadAdelante(a){this.indiceUnidadEditada=a,this.mostrarModalAgregarUnidad=!0},tipoDeTagParaTiempoTranscurrido(a){const e=new Date,t=e-a,r=9e4;return t>=r?"is-danger":"is-info"},estiloDeStrong(a){const e=new Date,t=e-a,r=9e4;return t>=r?{backgroundColor:"red"}:{}},async llamar(a){await W(a.id),await this.obtenerUnidades()},async moverAlFondo(a){for(let e=a+1;e<this.unidades.length;e++)await this.moverHaciaAdelante(e)},async eliminarUnidad(a){this.cargando=!0,await u.remove({from:"unidades",where:{id:a}}),this.cargando=!1},async eliminarDeLaLista(a){this.cargando=!0;const e=this.unidades.length;for(let t=a;t<e-1;t++){const a=this.unidades[t+1],e=this.unidades[t];await u.update({in:"unidades",set:{ruta:e.ruta,idRuta:e.ruta.id,esEspecial:e.esEspecial||!1},where:{id:a.id}})}await this.eliminarUnidad(this.unidades[a].id),await this.obtenerUnidades(),this.cargando=!1},async darSalida(a){const e=this.unidades[a];if(this.cargando=!0,await u.update({in:"unidades",set:{salida:(new Date).getTime(),segundosDesdeSalidaAnterior:999},where:{id:e.id}}),this.$buefy.toast.open("Salida marcada correctamente"),a+1<this.unidades.length){const e=this.unidades[a+1];e.horaLlamada||this.llamar(e)}await this.obtenerUnidades(),this.cargando=!1},transcurrido(a){const e=new Date(this.horaActual-new Date(a));return e.setTime(e.getTime()+60*e.getTimezoneOffset()*1e3),e},refrescarHora(){this.horaActual=new Date,clearTimeout(this.idTimeout),this.idTimeout=setTimeout(this.refrescarHora,500)},async moverRutaHaciaAdelante(a){if(this.cargando=!0,a<=0)return void this.$buefy.toast.open("No se puede mover hacia adelante la primera unidad");const e=this.unidades[a-1],t=this.unidades[a];await u.update({in:"unidades",set:{ruta:e.ruta,idRuta:e.ruta.id},where:{id:t.id}}),await u.update({in:"unidades",set:{ruta:t.ruta,idRuta:t.ruta.id},where:{id:e.id}}),await this.obtenerUnidades(),this.cargando=!1},async moverHaciaAdelante(a){if(this.cargando=!0,a<=0)return void this.$buefy.toast.open("No se puede mover hacia adelante la primera unidad");const e=this.unidades[a-1],t=this.unidades[a];await u.update({in:"unidades",set:{entrada:e.entrada,numero:e.numero},where:{id:t.id}}),await u.update({in:"unidades",set:{entrada:t.entrada,numero:t.numero},where:{id:e.id}}),await this.obtenerUnidades(),this.cargando=!1},atributosCelda(a){return{style:{backgroundColor:a.ruta.color}}},registrarNuevaUnidad(){this.$router.push({name:"RegistrarUnidad"})},async obtenerUnidades(){this.cargando=!0;let a=await Q(1677692874827,(new Date).getTime());for(let e=0;e<a.length;e++)a[e].rutasPrevias=await J(a[e].numero,0,(new Date).getTime()),a[e].ultimaUnidadQueFueALaMismaRuta=await X(a[e].id,a[e].ruta.id,0,(new Date).getTime());this.unidades=a,this.cargando=!1}}},ya=ga,_a=(0,b.Z)(ya,da,ua,!1,null,null,null),wa=_a.exports,Ta=function(){var a=this,e=a._self._c;return e("div",[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Nombre"}},[e("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.rol.nombre,callback:function(e){a.$set(a.rol,"nombre",e)},expression:"rol.nombre"}})],1),a._l(a.rol.rutas,(function(t,r){return e("b-field",{key:r,attrs:{label:"#"+(r+1)}},[e("b-select",{model:{value:a.rol.rutas[r],callback:function(e){a.$set(a.rol.rutas,r,e)},expression:"rol.rutas[indice]"}},a._l(a.rutas,(function(t){return e("option",{key:t.id,domProps:{value:t}},[a._v(" "+a._s(t.nombre)+" ")])})),0),e("p",{directives:[{name:"show",rawName:"v-show",value:a.deberiaMostrarBotonAgregar(r),expression:"deberiaMostrarBotonAgregar(indice)"}],staticClass:"control"},[e("b-button",{attrs:{type:"is-info"},on:{click:a.agregarRuta}},[e("b-icon",{attrs:{icon:"plus"}})],1)],1),e("p",{directives:[{name:"show",rawName:"v-show",value:a.deberiaMostrarBotonEliminar(),expression:"deberiaMostrarBotonEliminar()"}],staticClass:"control"},[e("b-button",{attrs:{type:"is-danger"},on:{click:function(e){return a.removerRuta(r)}}},[e("b-icon",{attrs:{icon:"delete"}})],1)],1)],1)})),e("b-button",{attrs:{disabled:!a.formularioEsValido(),type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),e("b-button",{staticClass:"ml-2",attrs:{type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],2)])])},Ea=[],Aa={data:()=>({rutas:[],rol:{nombre:"",rutas:[{}]}}),async mounted(){this.rutas=await E()},methods:{volver(){this.$router.go(-1)},formularioEsValido(){if(!this.rol.nombre)return!1;for(const a of this.rol.rutas)if(!a.nombre)return!1;return!0},async guardar(){await ta(this.rol.nombre,this.rol.rutas),this.$buefy.toast.open("Guardado"),this.rol={nombre:"",rutas:[{}]}},deberiaMostrarBotonAgregar(a){return a+1===this.rol.rutas.length},deberiaMostrarBotonEliminar(){return this.rol.rutas.length>1},agregarRuta(){this.rol.rutas.push({})},removerRuta(a){this.rol.rutas.splice(a,1)}}},Ca=Aa,ka=(0,b.Z)(Ca,Ta,Ea,!1,null,null,null),Ra=ka.exports,Da=function(){var a=this,e=a._self._c;return e("div",[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-button",{staticClass:"mb-2",attrs:{type:"is-info"},on:{click:a.registrarNuevoRol}},[a._v(" Registrar nuevo rol")]),e("b-field",{attrs:{label:"¿Cuál rol se usa hoy?"}},[e("b-select",{on:{input:a.onRolSeleccionadoCambiado},model:{value:a.rolSeleccionado,callback:function(e){a.rolSeleccionado=e},expression:"rolSeleccionado"}},a._l(a.roles,(function(t){return e("option",{key:t.id,domProps:{value:t}},[a._v(" "+a._s(t.nombre)+" ")])})),0)],1),e("b-table",{attrs:{data:a.roles,striped:!0},scopedSlots:a._u([{key:"empty",fn:function(){return[e("div",{staticClass:"has-text-centered"},[a._v("No hay datos")])]},proxy:!0}])},[e("b-table-column",{attrs:{field:"nombre",label:"Nombre"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v(" "+a._s(e.row.nombre)+" ")]}}])}),e("b-table-column",{attrs:{field:"rutas",label:"Orden"},scopedSlots:a._u([{key:"default",fn:function(e){return[a._v(" "+a._s(a.aplanarRutas(e.row.rutas))+" ")]}}])}),e("b-table-column",{attrs:{field:"id",label:"Eliminar"},scopedSlots:a._u([{key:"default",fn:function(t){return[e("b-button",{attrs:{type:"is-danger"},on:{click:function(e){return a.eliminar(t.row)}}},[e("b-icon",{attrs:{icon:"delete"}})],1)]}}])})],1)],1)])])},Sa=[],Na={data:()=>({rolSeleccionado:{},roles:[]}),async mounted(){await this.obtenerRoles(),this.rolSeleccionado=await oa()},methods:{async onRolSeleccionadoCambiado(){await aa(this.rolSeleccionado),this.$buefy.toast.open("Cambiado correctamente")},async eliminar(a){this.$buefy.dialog.confirm({message:`¿Eliminar rol ${a.nombre}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await ia(a.id),await this.obtenerRoles()}})},aplanarRutas(a){return a.map((a=>a.nombre)).join(", ")},registrarNuevoRol(){this.$router.push({name:"RegistrarRol"})},async obtenerRoles(){this.roles=await ra()}}},xa=Na,Ua=(0,b.Z)(xa,Da,Sa,!1,null,null,null),Oa=Ua.exports,Ma=function(){var a=this,e=a._self._c;return e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("p",[a._v("Ajustes")]),e("b-field",{attrs:{label:"Limpiar tabla"}},[e("b-select",{model:{value:a.tablaSeleccionada,callback:function(e){a.tablaSeleccionada=e},expression:"tablaSeleccionada"}},a._l(a.tablas,(function(t){return e("option",{key:t,domProps:{value:t}},[a._v(" "+a._s(t)+" ")])})),0),e("p",{staticClass:"control"},[e("b-button",{attrs:{type:"is-danger"},on:{click:function(e){return a.eliminarTablaSeleccionada()}}},[a._v(" Limpiar ")])],1)],1),e("b-button",{attrs:{type:"is-danger"},on:{click:a.eliminarTodaLaBaseDeDatos}},[a._v("Eliminar toda la base de datos")])],1)])},Ia=[],Pa={data:()=>({tablaSeleccionada:"",tablas:["rutas","ajustes","unidades","roles","horarios"]}),methods:{async eliminarTodaLaBaseDeDatos(){this.$buefy.dialog.confirm({message:"¿Eliminar base de datos completa? esto no se puede deshacer",cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await u.dropDb(),this.$buefy.toast.open("Base de datos eliminada. Tal vez sea necesario recargar")}})},eliminarTablaSeleccionada(){this.tablaSeleccionada&&this.$buefy.dialog.confirm({message:`¿Vaciar tabla ${this.tablaSeleccionada}?`,cancelText:"Cancelar",confirmText:"Sí",onConfirm:async()=>{await u.clear(this.tablaSeleccionada),this.$buefy.toast.open("Tabla limpiada")}})}}},La=Pa,Za=(0,b.Z)(La,Ma,Ia,!1,null,null,null),ja=Za.exports,za=function(){var a=this,e=a._self._c;return e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("div",{staticClass:"field has-addons"},[e("div",{staticClass:"control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.filtroNumeroUnidad,expression:"filtroNumeroUnidad"}],staticClass:"input",attrs:{type:"text",placeholder:"Filtrar"},domProps:{value:a.filtroNumeroUnidad},on:{input:[function(e){e.target.composing||(a.filtroNumeroUnidad=e.target.value)},a.filtrar]}})])]),a._l(a.unidades,(function(t,r){return e("div",{key:"grupo_"+r,staticClass:"mb-4"},a._l(t,(function(t,i){return e("p",{key:t.id,style:{backgroundColor:t.ruta.color}},[a._v(" "+a._s(i+r*a.chunkSize+1)+" "),e("b-tag",[a._v(a._s(t.numero))]),a._v(" "+a._s(t.ruta.nombre)+" "+a._s(a._f("fechaAPartirDeMilisegundos")(t.salida))+" ")],1)})),0)}))],2)])},Fa=[],$a={data:()=>({unidades:[],filtroNumeroUnidad:null,chunkSize:10}),async mounted(){await this.filtrar()},methods:{async filtrar(){let a=[],e=[];e=this.filtroNumeroUnidad?await B(parseInt(this.filtroNumeroUnidad)):await H();const t=this.chunkSize;for(let r=0;r<e.length;r+=t){const i=e.slice(r,r+t);a.push(i)}this.unidades=a}}},Va=$a,Ga=(0,b.Z)(Va,za,Fa,!1,null,null,null),Ba=Ga.exports,Ha=function(){var a=this;a._self._c;return a._m(0)},Ya=[function(){var a=this,e=a._self._c;return e("div",[e("h2",{staticClass:"is-size-2"},[a._v("Acerca de")]),e("article",{staticClass:"media"},[e("div",{staticClass:"media-content"},[e("div",{staticClass:"content"},[e("p",[e("strong",[a._v("Sistema gratuito y open source para base de micros")]),e("br"),a._v(" Código fuente disponible en "),e("a",{attrs:{href:"https://parzibyte.me/blog"}},[a._v("parzibyte.me/blog")]),a._v(" o tal vez en GitHub: "),e("a",{attrs:{href:"https://github.com/parzibyte"}},[a._v("https://github.com/parzibyte")]),e("br"),e("strong",[a._v("Creado y mantenido por ")]),e("small",[e("a",{attrs:{href:"https://parzibyte.me"}},[a._v("Parzibyte")])])])]),e("nav",{staticClass:"level is-mobile"},[e("div",{staticClass:"level-left"},[e("a",{staticClass:"level-item"},[e("span",{staticClass:"icon is-small"},[e("i",{staticClass:"fas fa-reply"})])]),e("a",{staticClass:"level-item"},[e("span",{staticClass:"icon is-small"},[e("i",{staticClass:"fas fa-retweet"})])]),e("a",{staticClass:"level-item"},[e("span",{staticClass:"icon is-small"},[e("i",{staticClass:"fas fa-heart"})])])])])])])])}],Wa={},Qa=(0,b.Z)(Wa,Ha,Ya,!1,null,null,null),Ja=Qa.exports,Xa=function(){var a=this,e=a._self._c;return e("div",[e("b-field",{attrs:{label:"Selecciona fecha"}},[e("b-datepicker",{attrs:{"show-week-number":!0,locale:"es-MX",icon:"calendar-today","icon-right":a.fecha?"close-circle":"","trap-focus":""},model:{value:a.fecha,callback:function(e){a.fecha=e},expression:"fecha"}})],1),e("table",[e("thead",[e("tr",[e("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"#e0e0e0"},attrs:{colspan:"3"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),e("tbody",a._l(a.rotarSegunDias(),(function(t,r){return e("tr",{key:t.id,style:a.estiloDeFila(r)},[e("td",{attrs:{contenteditable:""}},[a._v(" "+a._s(a.horarioOriginal.rutas[r].nombre)+" ")]),e("td",{attrs:{contenteditable:""}},[a._v(a._s(t.grupo.unidades.join(", ")))]),e("td",{attrs:{contenteditable:""}},[a._v(" "+a._s(t.grupo.nombre)+" ")])])})),0)]),e("br"),e("table",[e("thead",[e("tr",[e("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"yellow"},attrs:{colspan:"5"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),e("tbody",[e("tr",{staticStyle:{"background-color":"yellow"}},[e("td",{attrs:{rowspan:"2"}},[a._v("Tacopan")]),e("td",[a._v("6:30")]),e("td",[e("b-input",{model:{value:a.horariosTacopan[0],callback:function(e){a.$set(a.horariosTacopan,0,e)},expression:"horariosTacopan[0]"}})],1),e("td",[a._v("6:45")]),e("td",[e("b-input",{model:{value:a.horariosTacopan[1],callback:function(e){a.$set(a.horariosTacopan,1,e)},expression:"horariosTacopan[1]"}})],1)]),e("tr",{staticStyle:{"background-color":"yellow"}},[e("td",[a._v("7:00")]),e("td",[e("b-input",{model:{value:a.horariosTacopan[2],callback:function(e){a.$set(a.horariosTacopan,2,e)},expression:"horariosTacopan[2]"}})],1),e("td",[a._v("7:15")]),e("td",[e("b-input",{model:{value:a.horariosTacopan[3],callback:function(e){a.$set(a.horariosTacopan,3,e)},expression:"horariosTacopan[3]"}})],1)]),e("tr",{staticStyle:{"background-color":"yellow"}},[e("td",[a._v("Descansa")]),e("td",{attrs:{colspan:"2"}},[e("b-input",{model:{value:a.horariosTacopan[4],callback:function(e){a.$set(a.horariosTacopan,4,e)},expression:"horariosTacopan[4]"}})],1),e("td",{attrs:{colspan:"2"}},[e("b-input",{model:{value:a.horariosTacopan[5],callback:function(e){a.$set(a.horariosTacopan,5,e)},expression:"horariosTacopan[5]"}})],1)])])]),e("b-button",{on:{click:a.imprimir}},[a._v("Imprimir")]),e("br"),e("table",[e("thead",[e("tr",[e("th",{staticClass:"has-text-centered",staticStyle:{"background-color":"red",color:"black"},attrs:{colspan:"5"}},[a._v(" "+a._s(a.fechaFormateada())+" ")])])]),e("tbody",[e("tr",{staticStyle:{"background-color":"red"}},[e("td",[a._v("San Miguel")]),e("td",[a._v("7:10")]),e("td",[e("b-input")],1),e("td",[a._v("7:30")]),e("td",[e("b-input")],1)]),e("tr",{staticStyle:{"background-color":"red"}},[e("td",[a._v("Carrizal")]),e("td",[a._v("7:20")]),e("td",[e("b-input")],1),e("td",[a._v("7:40")]),e("td",[e("b-input")],1)]),e("tr",{staticStyle:{"background-color":"red"}},[e("td",[a._v("Descansa")]),e("td",{attrs:{colspan:"2"}},[e("b-input")],1),e("td",{attrs:{colspan:"2"}},[e("b-input")],1)])])])],1)},Ka=[];const qa=async(a,e)=>{const t=await u.insert({into:"horarios",values:[{rutas:a,marcaDeTiempo:e}],return:!0});return t[0]},ae=async()=>await u.select({from:"horarios"});var ee=t(7327);const te=(()=>{class a{constructor(a,e){this.nombre=a,this.argumentos=e}}class e{constructor(a,t){return a||(a=""),t||(t=e.URL_PLUGIN_POR_DEFECTO),this.ruta=t,this.operaciones=[],this.serial=a,this}CargarImagenLocalEImprimir(a,t,r){return this.operaciones.push(new e.Operacion("CargarImagenLocalEImprimir",Array.from(arguments))),this}Corte(a){return this.operaciones.push(new e.Operacion("Corte",Array.from(arguments))),this}CorteParcial(){return this.operaciones.push(new e.Operacion("CorteParcial",Array.from(arguments))),this}DescargarImagenDeInternetEImprimir(a,t,r){return this.operaciones.push(new e.Operacion("DescargarImagenDeInternetEImprimir",Array.from(arguments))),this}DeshabilitarElModoDeCaracteresChinos(){return this.operaciones.push(new e.Operacion("DeshabilitarElModoDeCaracteresChinos",Array.from(arguments))),this}EscribirTexto(a){return this.operaciones.push(new e.Operacion("EscribirTexto",Array.from(arguments))),this}EstablecerAlineacion(a){return this.operaciones.push(new e.Operacion("EstablecerAlineacion",Array.from(arguments))),this}EstablecerEnfatizado(a){return this.operaciones.push(new e.Operacion("EstablecerEnfatizado",Array.from(arguments))),this}EstablecerFuente(a){return this.operaciones.push(new e.Operacion("EstablecerFuente",Array.from(arguments))),this}EstablecerImpresionAlReves(a){return this.operaciones.push(new e.Operacion("EstablecerImpresionAlReves",Array.from(arguments))),this}EstablecerImpresionBlancoYNegroInversa(a){return this.operaciones.push(new e.Operacion("EstablecerImpresionBlancoYNegroInversa",Array.from(arguments))),this}EstablecerRotacionDe90Grados(a){return this.operaciones.push(new e.Operacion("EstablecerRotacionDe90Grados",Array.from(arguments))),this}EstablecerSubrayado(a){return this.operaciones.push(new e.Operacion("EstablecerSubrayado",Array.from(arguments))),this}"EstablecerTamañoFuente"(a,t){return this.operaciones.push(new e.Operacion("EstablecerTamañoFuente",Array.from(arguments))),this}Feed(a){return this.operaciones.push(new e.Operacion("Feed",Array.from(arguments))),this}HabilitarElModoDeCaracteresChinos(){return this.operaciones.push(new e.Operacion("HabilitarElModoDeCaracteresChinos",Array.from(arguments))),this}ImprimirCodigoDeBarras(a,t,r,i,o){return this.operaciones.push(new e.Operacion("ImprimirCodigoDeBarras",Array.from(arguments))),this}ImprimirImagenEnBase64(a,t,r){return this.operaciones.push(new e.Operacion("ImprimirImagenEnBase64",Array.from(arguments))),this}Iniciar(){return this.operaciones.push(new e.Operacion("Iniciar",Array.from(arguments))),this}Pulso(a,t,r){return this.operaciones.push(new e.Operacion("Pulso",Array.from(arguments))),this}TextoSegunPaginaDeCodigos(a,t,r){return this.operaciones.push(new e.Operacion("TextoSegunPaginaDeCodigos",Array.from(arguments))),this}static async obtenerImpresoras(a){a&&(e.URL_PLUGIN_POR_DEFECTO=a);const t=await fetch(e.URL_PLUGIN_POR_DEFECTO+"/impresoras");return await t.json()}async imprimirEn(a){const e={operaciones:this.operaciones,impresora:a,serial:this.serial},t=await fetch(this.ruta+"/imprimir",{method:"POST",body:JSON.stringify(e)});return await t.json()}}return(0,ee.Z)(e,"URL_PLUGIN_POR_DEFECTO","http://localhost:8000"),(0,ee.Z)(e,"Operacion",a),(0,ee.Z)(e,"TAMAÑO_IMAGEN_NORMAL",0),(0,ee.Z)(e,"TAMAÑO_IMAGEN_DOBLE_ANCHO",1),(0,ee.Z)(e,"TAMAÑO_IMAGEN_DOBLE_ALTO",2),(0,ee.Z)(e,"TAMAÑO_IMAGEN_DOBLE_ANCHO_Y_ALTO",3),(0,ee.Z)(e,"TAMAÑO_IMAGEN_DOBLE_ANCHO_Y_ALTO",3),(0,ee.Z)(e,"ALINEACION_IZQUIERDA",0),(0,ee.Z)(e,"ALINEACION_CENTRO",1),(0,ee.Z)(e,"ALINEACION_DERECHA",2),(0,ee.Z)(e,"RECUPERACION_QR_BAJA",0),(0,ee.Z)(e,"RECUPERACION_QR_MEDIA",1),(0,ee.Z)(e,"RECUPERACION_QR_ALTA",2),(0,ee.Z)(e,"RECUPERACION_QR_MEJOR",3),e})();function re(a,e){const t=a.length;return a.push(...a.splice(0,(-e%t+t)%t)),a}var ie={data:()=>({fecha:new Date,rutas:[],horario:{},horarioOriginal:{},horariosTacopan:["","","","","",""]}),async mounted(){const a=new Date;a.setHours(0,0,0,0),this.fecha=a,await this.obtenerRutas(),await this.obtenerHorario()},methods:{async imprimir(){const a=new te("N2ZiYTJiMzVfXzIwMjMtMDMtMzBfXzIwMjMtMDQtMjkjIyN3aVRxdGJxWGExT2ZrSGd1UDExaEF6dWpwVFI4ZkcxaEsyUS95bThkSU9hSzQvUk5WcFRBdmxReGhpVkF1d3FsV0pUdWVnTmVxNXpYbDI1RmVGMmZvbjE1ZE1ydWhhWFd6K2hvVGs5OHIzRXVsMkJ4V25mbEpkQTY1dWUyVE80VlREWG5lUldwZTBmc3JIMXk2VEFrTXo0dlJwYjVGQlU0bTBzbUptT2tFdTZxVXUxOHU3aEU5eU1OWVArd2ZxTlYwNXJGMWZMaUdVNnRUUm1IaWhMTHpmTnR4eVB4STBVbFNGNDRubHVlNWhoUWtER2dCb0w4MEhWazFOa1AvMXdvSys2UVVieFBmRHlrSklhcTNsYUw1dFQxMnN3UWxNQjBuRThoZ041OFJBZHI2Y29MV0ZNSm1mWFJVMC9nLzRZQ09QNGlHWTIxUkdBNTlWaDBCRzFDdWk3Y2t5Y25jTjlUcTZSSjJUOTl5cUFqeVNrN2paOGt1RUROMlpJZ0Q1QW1ydkJwdDVZNElveDk4RndJQ2VMSWNITGE4MG96dzFBR2hreHJKN0hJdWhCb1lGSFMxMFJ6eVJCTjUyVHNpZkM1MjNEd3B6NnZrUkRGMitWTVZkY2ZJWWlhZC9ka0Vsd3p2Z3FFNW95dzVoZUwzTy9xQVJoaThHWjlCWkdBUTFTSg==",te.URL_PLUGIN_POR_DEFECTO);this.$buefy.toast.open("Imprimiendo..."),a.EstablecerAlineacion(te.ALINEACION_CENTRO).EscribirTexto("Urbanos rojos\n").EscribirTexto("Abraham Cabrera\n").EscribirTexto("231 159 18 93\n\n Si tienes dudas con tu horario, no trabajaste el día anterior o no te dieron tu nota mándame WhatsApp y yo te mando la ruta que te toca (no recibo llamadas)\n").EscribirTexto("=============================\n").EscribirTexto("Horarios para Tacopan\n").EscribirTexto(this.fechaFormateada()+"\n").EscribirTexto("=============================\n").EstablecerAlineacion(te.ALINEACION_IZQUIERDA).EscribirTexto("6:30 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[0]+"\n").EstablecerEnfatizado(!1).EscribirTexto("6:45 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[1]+"\n").EstablecerEnfatizado(!1).EscribirTexto("7:00 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[2]+"\n").EstablecerEnfatizado(!1).EscribirTexto("7:15 ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[3]+"\n").EstablecerEnfatizado(!1).Feed(1).EscribirTexto("=============================\n").EstablecerAlineacion(te.ALINEACION_CENTRO).EscribirTexto("Descansa\n").EstablecerAlineacion(te.ALINEACION_IZQUIERDA).EscribirTexto("Coahuixco ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[4]+"\n").EstablecerEnfatizado(!1).EscribirTexto("Coahuixco ").EstablecerEnfatizado(!0).EscribirTexto(this.horariosTacopan[5]+"\n").EstablecerEnfatizado(!1).Feed(2);try{const e=await a.imprimirEn("86:67:7A:A6:AD:8B");e?this.$buefy.toast.open("Impreso correctamente"):this.$buefy.toast.open({message:e,type:"is-danger"})}catch(e){this.$buefy.toast.open({message:e.message,type:"is-danger"})}},fechaFormateada(){const a=new Intl.DateTimeFormat("es-MX",{dateStyle:"full"});return a.format(this.fecha)},rotarSegunDias(){if(!this.horario.rutas)return[];const a=this.horario.rutas.slice(0);return re(a,this.diferenciaDeDias()%8)},diferenciaDeDias(){return this.horario?(this.fecha.getTime()-this.horario.marcaDeTiempo)/1e3/60/60/24:0},estiloDeFila(a){return{backgroundColor:this.horarioOriginal.rutas[a].color}},volver(){this.$router.go(-1)},async obtenerRutas(){this.rutas=await E()},async obtenerHorario(){const a=await ae();a.length>0?(this.horario=a[0],this.horarioOriginal=a[0]):this.$buefy.toast.open("No hay horarios registrados")}}},oe=ie,ne=(0,b.Z)(oe,Xa,Ka,!1,null,"477d2ceb",null),se=ne.exports,le=function(){var a=this,e=a._self._c;return e("div",[e("div",{staticClass:"columns"},[e("div",{staticClass:"column"},[e("b-field",{attrs:{label:"Nombre"}},[e("b-input",{attrs:{placeholder:"Nombre"},model:{value:a.grupo.nombre,callback:function(e){a.$set(a.grupo,"nombre",e)},expression:"grupo.nombre"}})],1),e("b-field",{attrs:{label:"Ingrese unidades separadas por coma"}},[e("b-input",{attrs:{type:"textarea"},model:{value:a.unidadesRaw,callback:function(e){a.unidadesRaw=e},expression:"unidadesRaw"}})],1),e("b-notification",{attrs:{type:"is-success",closable:!1}},[e("strong",[a._v("Las unidades que pertenecen al grupo son:")]),e("br"),a._l(a.parsearUnidades(),(function(t,r){return e("b-tag",{key:r,staticClass:"m-1"},[a._v(" "+a._s(t)+" ")])}))],2),e("b-button",{attrs:{disabled:!a.formularioEsValido(),type:"is-success"},on:{click:a.guardar}},[a._v("Guardar")]),e("b-button",{staticClass:"ml-2",attrs:{type:"is-info"},on:{click:a.volver}},[a._v("Volver")])],1)])])},ce=[];const de=async(a,e,t)=>{const r=await u.insert({into:"grupos",values:[{nombre:a,unidades:e,unidadesRaw:t}],return:!0});return r[0]},ue=async()=>await u.select({from:"grupos"});var me={data:()=>({rutas:[],unidadesRaw:"",grupo:{nombre:"",unidades:[null]}}),async mounted(){this.rutas=await E()},methods:{parsearUnidades(){return this.unidadesRaw.split(",").map(Number)},volver(){this.$router.go(-1)},formularioEsValido(){return!!this.grupo.nombre&&!(this.parsearUnidades().length<=0)},async guardar(){await de(this.grupo.nombre,this.parsearUnidades(),this.unidadesRaw),this.$buefy.toast.open("Guardado")},deberiaMostrarBotonAgregar(a){return a+1===this.grupo.unidades.length},deberiaMostrarBotonEliminar(){return this.grupo.unidades.length>1},agregarUnidad(){this.grupo.unidades.push({})},removerUnidad(a){this.grupo.unidades.splice(a,1)}}},he=me,pe=(0,b.Z)(he,le,ce,!1,null,null,null),be=pe.exports,fe=function(){var a=this,e=a._self._c;return e("div",[e("table",{staticClass:"table"},[e("tbody",a._l(a.rutas,(function(t,r){return e("tr",{key:t.id},[e("td",[a._v(a._s(t.nombre))]),e("td",[e("b-select",{model:{value:a.rutas[r].grupo,callback:function(e){a.$set(a.rutas[r],"grupo",e)},expression:"rutas[indiceRuta].grupo"}},a._l(a.grupos,(function(t){return e("option",{key:t.id,domProps:{value:t}},[a._v(" "+a._s(t.nombre)+" ")])})),0)],1),e("td",[a._v(" "+a._s(t.grupo.unidades)+" ")])])})),0)]),e("b-button",{on:{click:a.guardar}},[a._v("Guardar")])],1)},ve=[],ge={data:()=>({rutas:[],grupos:[]}),async mounted(){await this.obtenerRutas(),await this.obtenerGrupos()},methods:{async guardar(){const a=new Date;a.setHours(0,0,0,0),await qa(this.rutas,a.getTime())},async obtenerRutas(){let a=await E();a=a.map((a=>Object.assign({grupo:{}},a))),this.rutas=a},async obtenerGrupos(){this.grupos=await ue()}}},ye=ge,_e=(0,b.Z)(ye,fe,ve,!1,null,null,null),we=_e.exports;r.ZP.use(y.Z);var Te=new y.Z({routes:[{path:"/registrar-ruta",name:"RegistrarRuta",component:S},{path:"/rutas",name:"VerRutas",component:I},{path:"/unidades",name:"GestionarUnidades",component:wa},{path:"/registrar-unidad",name:"RegistrarUnidad",component:ca},{path:"/registrar-rol",name:"RegistrarRol",component:Ra},{path:"/roles",name:"VerRoles",component:Oa},{path:"/ajustes",name:"Ajustes",component:ja},{path:"/reporte",name:"ReporteUnidades",component:Ba},{path:"/acerca-de",name:"AcercaDe",component:Ja},{path:"/tabla-horarios",name:"TablaHorarios",component:se},{path:"/registrar-grupo",name:"RegistrarGrupo",component:be},{path:"/registrar-horario",name:"RegistrarHorario",component:we}]});r.ZP.config.productionTip=!1,r.ZP.use(g.ZP);const Ee=new Intl.DateTimeFormat("es-MX",{timeStyle:"medium"});r.ZP.filter("fechaAPartirDeMilisegundos",(a=>a?Ee.format(new Date(a)):"")),new r.ZP({render:a=>a(v),router:Te}).$mount("#app")}},e={};function t(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return a[r](o,o.exports,t),o.exports}t.m=a,function(){var a=[];t.O=function(e,r,i,o){if(!r){var n=1/0;for(d=0;d<a.length;d++){r=a[d][0],i=a[d][1],o=a[d][2];for(var s=!0,l=0;l<r.length;l++)(!1&o||n>=o)&&Object.keys(t.O).every((function(a){return t.O[a](r[l])}))?r.splice(l--,1):(s=!1,o<n&&(n=o));if(s){a.splice(d--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var d=a.length;d>0&&a[d-1][2]>o;d--)a[d]=a[d-1];a[d]=[r,i,o]}}(),function(){t.n=function(a){var e=a&&a.__esModule?function(){return a["default"]}:function(){return a};return t.d(e,{a:e}),e}}(),function(){t.d=function(a,e){for(var r in e)t.o(e,r)&&!t.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:e[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(a){if("object"===typeof window)return window}}()}(),function(){t.o=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)}}(),function(){var a={143:0};t.O.j=function(e){return 0===a[e]};var e=function(e,r){var i,o,n=r[0],s=r[1],l=r[2],c=0;if(n.some((function(e){return 0!==a[e]}))){for(i in s)t.o(s,i)&&(t.m[i]=s[i]);if(l)var d=l(t)}for(e&&e(r);c<n.length;c++)o=n[c],t.o(a,o)&&a[o]&&a[o][0](),a[o]=0;return t.O(d)},r=self["webpackChunkchecador_base"]=self["webpackChunkchecador_base"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=t.O(void 0,[998],(function(){return t(2149)}));r=t.O(r)})();